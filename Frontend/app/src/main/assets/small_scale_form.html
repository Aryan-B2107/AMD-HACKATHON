<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title id="pageTitle">Dynamic Environment Form</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Base styles to remove default margins and box-sizing */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        /* Define a consistent font and smooth scrolling behavior */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #F0FFF0; /* Matching the roadmap's minty green background */
        }

        /* Apply a fluid animation on page load */
        #root {
            animation: fadeIn 0.5s ease-out;
        }

        /* Fade-in and fade-out animations for page transitions */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fade-out {
            animation: fadeOut 0.4s ease-out forwards;
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        /* Custom styling for the select dropdown arrow */
        select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
        }

        /* Styles for floating background emojis inside containers */
        .floating-emoji-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Allows clicks to pass through */
            overflow: hidden;
            z-index: 0; /* Ensures emojis are behind content but inside the card */
        }
        .floating-emoji {
            position: absolute;
            opacity: 0.15; /* Subtler opacity */
            animation-name: float-and-wave-card;
            animation-iteration-count: infinite;
            animation-timing-function: linear;
            font-size: 2rem;
        }

        /* Keyframes for floating animation inside a smaller container */
        @keyframes float-and-wave-card {
            0% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(2rem, -1rem) scale(1.1); }
            50% { transform: translate(0, -2rem) scale(1.2); }
            75% { transform: translate(-2rem, -1rem) scale(1.1); }
            100% { transform: translate(0, 0) scale(1); }
        }

        /* Hover effects */
        .clickable:hover {
            background-color: rgba(248, 250, 252, 0.8);
        }
        .clickable:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center">
<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // --- Translation and Configuration Data ---
    const TRANSLATIONS = {
        en: {
            pageTitle: "Dynamic Environment Form",
            backButton: "Back to previous step",
            required: "is required",
            langToggle: "ML", // Button text when currently in English
            submitText: "Create My Farming Roadmap üå±",
            submittingText: "Creating Roadmap..."
        },
        ml: {
            pageTitle: "‡¥°‡µà‡¥®‡¥æ‡¥Æ‡¥ø‡¥ï‡µç ‡¥™‡¥∞‡¥ø‡¥∏‡µç‡¥•‡¥ø‡¥§‡¥ø ‡¥´‡µã‡¥Ç",
            backButton: "‡¥™‡¥ø‡¥®‡µç‡¥®‡µã‡¥ü‡µç‡¥ü‡µç ‡¥™‡µã‡¥ï‡µÅ‡¥ï",
            required: "‡¥®‡¥ø‡µº‡¥¨‡¥®‡µç‡¥ß‡¥Æ‡¥æ‡¥£‡µç",
            langToggle: "En", // Button text when currently in Malayalam
            submitText: "‡¥é‡µª‡µç‡¥±‡µÜ ‡¥ï‡¥æ‡µº‡¥∑‡¥ø‡¥ï ‡¥±‡µã‡¥°‡µç‡¥Æ‡¥æ‡¥™‡µç‡¥™‡µç ‡¥§‡¥Ø‡µç‡¥Ø‡¥æ‡¥±‡¥æ‡¥ï‡µç‡¥ï‡µÅ‡¥ï üå±",
            submittingText: "‡¥∏‡¥Æ‡µº‡¥™‡µç‡¥™‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ..."
        }
    };

    const FORM_CONFIGS = {
        en: {
            title: "Tell Us About Your Farm Field",
            description: "Provide key details for AI-powered, optimized farming advice.",
            sections: [
                {
                    "title": "Field Location & Scale",
                    "icon": "üìç",
                    "rows": [
                        [
                            {
                                "id": "fieldLocation",
                                "type": "text",
                                "label": "Field Location:",
                                "placeholder": "Town and nearest address/landmark",
                                "required": true
                            }
                        ],
                        [
                            {
                                "id": "fieldSize",
                                "type": "text",
                                "label": "Field Size:",
                                "placeholder": "e.g., 80 acres or 30 hectares",
                                "required": true
                            }
                        ]
                    ]
                },
                {
                    "title": "Crop & History",
                    "icon": "üöú",
                    "rows": [
                        [
                            {
                                "id": "currentCrop",
                                "type": "text",
                                "label": "Current Crop:",
                                "placeholder": "Crop and specific variety (e.g., Soybeans, Asgrow 32X8)",
                                "required": true
                            }
                        ],
                        [
                            {
                                "id": "previousCrop",
                                "type": "text",
                                "label": "Previous Crop:",
                                "placeholder": "What was grown in this field last season?",
                                "required": true
                            }
                        ],
                        [
                            {
                                "id": "targetYield",
                                "type": "text",
                                "label": "Target Yield:",
                                "placeholder": "e.g., 180 bushels/acre or 25 tonnes/hectare",
                                "required": true
                            }
                        ]
                    ]
                },
                {
                    "title": "Water & Soil Management",
                    "icon": "üíß",
                    "rows": [
                        [
                            {
                                "id": "waterSource",
                                "type": "text",
                                "label": "Water Source:",
                                "placeholder": "e.g., Well, Canal, River, or Rain-fed only",
                                "required": true
                            }
                        ],
                        [
                            {
                                "id": "irrigationType",
                                "type": "text",
                                "label": "Irrigation Type:",
                                "placeholder": "e.g., Drip, Pivot, Flood, or None",
                                "required": true
                            }
                        ],
                        [
                            {
                                "id": "soilPH",
                                "type": "text",
                                "label": "Soil pH:",
                                "placeholder": "e.g., 6.5 (from a recent soil test)",
                                "required": false // Made optional as farmer might not have test data
                            }
                        ],
                        [
                            {
                                "id": "soilType",
                                "type": "text",
                                "label": "Soil Type:",
                                "placeholder": "e.g., Sandy, Clay, Loamy",
                                "required": false
                            }
                        ],
                        [
                            {
                                "id": "fertilizerUsed",
                                "type": "text",
                                "label": "Fertilizer Used:",
                                "placeholder": "e.g., Manure/Compost, Synthetic Granules, or Liquid Feed",
                                "required": false
                            }
                        ]
                    ]
                }
            ]
        },
        ml: {
            title: "‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥ï‡µÉ‡¥∑‡¥ø‡¥Ø‡¥ø‡¥ü‡¥§‡µç‡¥§‡µÜ‡¥ï‡µç‡¥ï‡µÅ‡¥±‡¥ø‡¥ö‡µç‡¥ö‡µç ‡¥™‡¥±‡¥Ø‡µÅ‡¥ï",
            description: "‡¥Æ‡¥ø‡¥ï‡¥ö‡µç‡¥ö ‡¥ï‡¥æ‡µº‡¥∑‡¥ø‡¥ï ‡¥â‡¥™‡¥¶‡µá‡¥∂‡¥§‡µç‡¥§‡¥ø‡¥®‡¥æ‡¥Ø‡¥ø ‡¥™‡µç‡¥∞‡¥ß‡¥æ‡¥® ‡¥µ‡¥ø‡¥µ‡¥∞‡¥ô‡µç‡¥ô‡µæ ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï.",
            sections: [
                {
                    "title": "‡¥∏‡µç‡¥•‡¥≤‡¥µ‡µÅ‡¥Ç ‡¥µ‡¥ø‡¥∏‡µç‡¥§‡µÄ‡µº‡¥£‡µç‡¥£‡¥µ‡µÅ‡¥Ç",
                    "icon": "üìç",
                    "rows": [
                        [
                            {
                                "id": "fieldLocation",
                                "type": "text",
                                "label": "‡¥ï‡µÉ‡¥∑‡¥ø‡¥Ø‡¥ø‡¥ü‡¥§‡µç‡¥§‡¥ø‡µª‡µç‡¥±‡µÜ ‡¥∏‡µç‡¥•‡¥≤‡¥Ç:",
                                "placeholder": "‡¥®‡¥ó‡¥∞‡¥µ‡µÅ‡¥Ç ‡¥Ö‡¥ü‡µÅ‡¥§‡µç‡¥§‡µÅ‡¥≥‡µç‡¥≥ ‡¥µ‡¥ø‡¥≤‡¥æ‡¥∏‡¥µ‡µÅ‡¥Ç/‡¥Ö‡¥ü‡¥Ø‡¥æ‡¥≥‡¥µ‡µÅ‡¥Ç",
                                "required": true
                            }
                        ],
                        [
                            {
                                "id": "fieldSize",
                                "type": "text",
                                "label": "‡¥ï‡µÉ‡¥∑‡¥ø‡¥Ø‡¥ø‡¥ü‡¥§‡µç‡¥§‡¥ø‡µª‡µç‡¥±‡µÜ ‡¥µ‡¥ø‡¥∏‡µç‡¥§‡µÄ‡µº‡¥£‡µç‡¥£‡¥Ç:",
                                "placeholder": "‡¥â‡¥¶‡¥æ: 80 ‡¥è‡¥ï‡µç‡¥ï‡µº ‡¥Ö‡¥≤‡µç‡¥≤‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ 30 ‡¥π‡µÜ‡¥ï‡µç‡¥ü‡µº",
                                "required": true
                            }
                        ]
                    ]
                },
                {
                    "title": "‡¥µ‡¥ø‡¥≥‡¥Ø‡µÅ‡¥Ç ‡¥ö‡¥∞‡¥ø‡¥§‡µç‡¥∞‡¥µ‡µÅ‡¥Ç",
                    "icon": "üöú",
                    "rows": [
                        [
                            {
                                "id": "currentCrop",
                                "type": "text",
                                "label": "‡¥®‡¥ø‡¥≤‡¥µ‡¥ø‡¥≤‡µÜ ‡¥µ‡¥ø‡¥≥:",
                                "placeholder": "‡¥µ‡¥ø‡¥≥‡¥Ø‡µÅ‡¥Ç ‡¥á‡¥®‡¥µ‡µÅ‡¥Ç (‡¥â‡¥¶‡¥æ: ‡¥∏‡µã‡¥Ø‡¥æ‡¥¨‡µÄ‡µª‡¥∏‡µç, ‡¥Ö‡¥∏‡µç‡¥ó‡µç‡¥∞‡µã 32X8)",
                                "required": true
                            }
                        ],
                        [
                            {
                                "id": "previousCrop",
                                "type": "text",
                                "label": "‡¥Æ‡µÅ‡µª ‡¥µ‡¥ø‡¥≥:",
                                "placeholder": "‡¥ï‡¥¥‡¥ø‡¥û‡µç‡¥û ‡¥∏‡µÄ‡¥∏‡¥£‡¥ø‡µΩ ‡¥à ‡¥™‡¥æ‡¥ü‡¥§‡µç‡¥§‡µç ‡¥é‡¥®‡µç‡¥§‡¥æ‡¥£‡µç ‡¥ï‡µÉ‡¥∑‡¥ø ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡¥§‡µç?",
                                "required": true
                            }
                        ],
                        [
                            {
                                "id": "targetYield",
                                "type": "text",
                                "label": "‡¥≤‡¥ï‡µç‡¥∑‡µç‡¥Ø‡¥Æ‡¥ø‡¥ü‡µÅ‡¥®‡µç‡¥® ‡¥µ‡¥ø‡¥≥‡¥µ‡µç:",
                                "placeholder": "‡¥â‡¥¶‡¥æ: ‡¥è‡¥ï‡µç‡¥ï‡¥±‡¥ø‡¥®‡µç 180 ‡¥¨‡µÅ‡¥∑‡µΩ ‡¥Ö‡¥≤‡µç‡¥≤‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥π‡µÜ‡¥ï‡µç‡¥ü‡¥±‡¥ø‡¥®‡µç 25 ‡¥ü‡µ∫",
                                "required": true
                            }
                        ]
                    ]
                },
                {
                    "title": "‡¥ú‡¥≤-‡¥Æ‡¥£‡µç‡¥£‡µç ‡¥™‡¥∞‡¥ø‡¥™‡¥æ‡¥≤‡¥®‡¥Ç",
                    "icon": "üíß",
                    "rows": [
                        [
                            {
                                "id": "waterSource",
                                "type": "text",
                                "label": "‡¥ú‡¥≤‡¥∏‡µç‡¥∞‡µã‡¥§‡¥∏‡µç‡¥∏‡µç:",
                                "placeholder": "‡¥â‡¥¶‡¥æ: ‡¥ï‡¥ø‡¥£‡µº, ‡¥ï‡¥®‡¥æ‡µΩ, ‡¥®‡¥¶‡¥ø, ‡¥Ö‡¥≤‡µç‡¥≤‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥Æ‡¥¥‡¥Ø‡µÜ ‡¥Æ‡¥æ‡¥§‡µç‡¥∞‡¥Ç ‡¥Ü‡¥∂‡µç‡¥∞‡¥Ø‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡µç",
                                "required": true
                            }
                        ],
                        [
                            {
                                "id": "irrigationType",
                                "type": "text",
                                "label": "‡¥ú‡¥≤‡¥∏‡µá‡¥ö‡¥® ‡¥∞‡µÄ‡¥§‡¥ø:",
                                "placeholder": "‡¥â‡¥¶‡¥æ: ‡¥°‡µç‡¥∞‡¥ø‡¥™‡µç‡¥™‡µç, ‡¥™‡¥ø‡¥µ‡¥±‡µç‡¥±‡µç, ‡¥´‡µç‡¥≤‡¥°‡µç, ‡¥Ö‡¥≤‡µç‡¥≤‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥í‡¥®‡µç‡¥®‡µÅ‡¥Æ‡¥ø‡¥≤‡µç‡¥≤",
                                "required": true
                            }
                        ],
                        [
                            {
                                "id": "soilPH",
                                "type": "text",
                                "label": "‡¥Æ‡¥£‡µç‡¥£‡¥ø‡µª‡µç‡¥±‡µÜ $\text{pH}$:",
                                "placeholder": "‡¥â‡¥¶‡¥æ: 6.5 (‡¥è‡¥±‡µç‡¥±‡¥µ‡µÅ‡¥Ç ‡¥™‡µÅ‡¥§‡¥ø‡¥Ø ‡¥™‡¥∞‡¥ø‡¥∂‡µã‡¥ß‡¥®‡¥Ø‡¥ø‡µΩ ‡¥®‡¥ø‡¥®‡µç‡¥®‡µç)",
                                "required": false
                            }
                        ],
                        [
                            {
                                "id": "soilType",
                                "type": "text",
                                "label": "‡¥Æ‡¥£‡µç‡¥£‡¥ø‡µª‡µç‡¥±‡µÜ ‡¥§‡¥∞‡¥Ç:",
                                "placeholder": "‡¥â‡¥¶‡¥æ: ‡¥Æ‡¥£‡µΩ ‡¥Æ‡¥£‡µç‡¥£‡µç, ‡¥ï‡¥≥‡¥ø‡¥Æ‡¥£‡µç‡¥£‡µç, ‡¥é‡¥ï‡µç‡¥ï‡µΩ ‡¥Æ‡¥£‡µç‡¥£‡µç",
                                "required": false
                            }
                        ],
                        [
                            {
                                "id": "fertilizerUsed",
                                "type": "text",
                                "label": "‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥® ‡¥µ‡¥≥‡¥Ç:",
                                "placeholder": "‡¥â‡¥¶‡¥æ: ‡¥ö‡¥æ‡¥£‡¥ï‡¥Ç/‡¥ï‡¥Æ‡µç‡¥™‡µã‡¥∏‡µç‡¥±‡µç‡¥±‡µç, ‡¥∏‡¥ø‡¥®‡µç‡¥§‡¥±‡µç‡¥±‡¥ø‡¥ï‡µç ‡¥ó‡µç‡¥∞‡¥æ‡¥®‡µÇ‡¥≥‡µÅ‡¥ï‡µæ, ‡¥Ö‡¥≤‡µç‡¥≤‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥≤‡¥ø‡¥ï‡µç‡¥µ‡¥ø‡¥°‡µç ‡¥´‡µÄ‡¥°‡µç",
                                "required": false
                            }
                        ]
                    ]
                }
            ]
        }
    };
    // --- End Translation and Configuration Data ---


    // Function to create a single floating emoji element inside a specified container
    const createEmoji = (container) => {
        const emojis = ['üåæ', 'üöú', 'üíß', 'üå±', 'üåø', 'üçÖ', 'üåΩ', 'üí∞'];
        const emoji = document.createElement('span');
        emoji.className = 'floating-emoji';
        emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];

        // Randomize position, size, and animation
        const startX = Math.random() * 100;
        const startY = Math.random() * 100;
        const size = 1.5 + Math.random() * 1.5; // 1.5 to 3rem
        const duration = 10 + Math.random() * 5; // 10 to 15 seconds

        emoji.style.left = `${startX}%`;
        emoji.style.top = `${startY}%`;
        emoji.style.fontSize = `${size}rem`;
        emoji.style.animationDuration = `${duration}s`;
        emoji.style.animationDelay = `${Math.random() * duration}s`;

        container.appendChild(emoji);
    };

    // Function to populate a container with a certain number of emojis
    const populateContainerWithEmojis = (container, count) => {
        for (let i = 0; i < count; i++) {
            createEmoji(container);
        }
    };

    // Component for floating emojis
    const FloatingEmojiContainer = ({ count = 8 }) => {
        const containerRef = useRef(null);

        useEffect(() => {
            if (containerRef.current) {
                // Clear any existing emojis
                containerRef.current.innerHTML = '';
                populateContainerWithEmojis(containerRef.current, count);
            }
        }, [count]);

        return <div ref={containerRef} className="floating-emoji-container" />;
    };

    // Component for a standard text input field
    const TextInput = ({ field, value, onChange, error }) => (
        <div className="mb-4">
            <label htmlFor={field.id} className="block mb-2 text-gray-800 font-medium relative z-10">{field.label}</label>
            <input
                type={field.inputType || 'text'}
                id={field.id}
                value={value || ''}
                onChange={(e) => onChange(field.id, e.target.value)}
                placeholder={field.placeholder}
                required={field.required}
                className="w-full p-3 border-2 border-gray-200 rounded-xl text-gray-800 bg-white/90 focus:outline-none focus:border-green-600 focus:ring-2 focus:ring-green-600/20 transition-all relative z-10 shadow-sm"
            />
            {error && <div className="text-red-600 text-sm mt-1 relative z-10">{error}</div>}
        </div>
    );

    // Component for a select dropdown field (kept for general utility)
    const SelectInput = ({ field, value, onChange, error }) => (
        <div className="mb-4">
            <label htmlFor={field.id} className="block mb-2 text-gray-800 font-medium relative z-10">{field.label}</label>
            <select
                id={field.id}
                value={value || ''}
                onChange={(e) => onChange(field.id, e.target.value)}
                required={field.required}
                className="w-full p-3 border-2 border-gray-200 rounded-xl text-gray-800 bg-white/90 focus:outline-none focus:border-green-600 focus:ring-2 focus:ring-green-600/20 transition-all cursor-pointer appearance-none relative z-10 shadow-sm"
            >
                <option value="">{field.placeholder || 'Select an option'}</option>
                {field.options.map(option => (
                    <option key={option.value} value={option.value}>
                        {option.label}
                    </option>
                ))}
            </select>
            {error && <div className="text-red-600 text-sm mt-1 relative z-10">{error}</div>}
        </div>
    );

    // Component for a textarea field (kept for general utility)
    const TextAreaInput = ({ field, value, onChange, error }) => (
        <div className="mb-4">
            <label htmlFor={field.id} className="block mb-2 text-gray-800 font-medium relative z-10">{field.label}</label>
            <textarea
                id={field.id}
                value={value || ''}
                onChange={(e) => onChange(field.id, e.target.value)}
                placeholder={field.placeholder}
                required={field.required}
                className="w-full p-3 border-2 border-gray-200 rounded-xl text-gray-800 bg-white/90 focus:outline-none focus:border-green-600 focus:ring-2 focus:ring-green-600/20 transition-all min-h-[80px] resize-y relative z-10 shadow-sm"
            />
            {error && <div className="text-red-600 text-sm mt-1 relative z-10">{error}</div>}
        </div>
    );

    // Component for a group of checkboxes (kept for general utility)
    const CheckboxGroup = ({ field, value, onChange, error }) => (
        <div className="mb-4">
            <label className="block mb-2 text-gray-800 font-medium relative z-10">{field.label}</label>
            <div className="flex flex-col gap-2">
                {field.options.map(option => (
                    <div key={option.value} className="flex items-center p-3 bg-slate-50 rounded-xl border border-gray-100 cursor-pointer transition-colors clickable min-h-[48px] shadow-sm relative overflow-hidden">
                        <FloatingEmojiContainer count={3} />
                        <input
                            type="checkbox"
                            id={`${field.id}-${option.value}`}
                            checked={(value || []).includes(option.value)}
                            onChange={(e) => {
                                const currentValues = value || [];
                                const newValues = e.target.checked
                                    ? [...currentValues, option.value]
                                    : currentValues.filter(v => v !== option.value);
                                onChange(field.id, newValues);
                            }}
                            className="w-5 h-5 mr-3 accent-green-600 cursor-pointer relative z-10"
                        />
                        <label htmlFor={`${field.id}-${option.value}`} className="flex-1 cursor-pointer text-gray-800 text-sm m-0 relative z-10">{option.label}</label>
                    </div>
                ))}
            </div>
            {error && <div className="text-red-600 text-sm mt-1 relative z-10">{error}</div>}
        </div>
    );

    // Component for a group of radio buttons (kept for general utility)
    const RadioGroup = ({ field, value, onChange, error }) => (
        <div className="mb-4">
            <label className="block mb-2 text-gray-800 font-medium relative z-10">{field.label}</label>
            <div className="flex flex-col gap-2">
                {field.options.map(option => (
                    <div key={option.value} className="flex items-center p-3 bg-slate-50 rounded-xl border border-gray-100 cursor-pointer transition-colors clickable min-h-[48px] shadow-sm relative overflow-hidden">
                        <FloatingEmojiContainer count={3} />
                        <input
                            type="radio"
                            id={`${field.id}-${option.value}`}
                            name={field.id}
                            value={option.value}
                            checked={value === option.value}
                            onChange={(e) => onChange(field.id, e.target.value)}
                            className="w-5 h-5 mr-3 accent-green-600 cursor-pointer relative z-10"
                        />
                        <label htmlFor={`${field.id}-${option.value}`} className="flex-1 cursor-pointer text-gray-800 text-sm m-0 relative z-10">{option.label}</label>
                    </div>
                ))}
            </div>
            {error && <div className="text-red-600 text-sm mt-1 relative z-10">{error}</div>}
        </div>
    );

    // Renders the correct input component based on the field type
    const FieldRenderer = ({ field, value, onChange, error }) => {
        switch (field.type) {
            case 'text':
            case 'email':
            case 'number':
                return <TextInput field={field} value={value} onChange={onChange} error={error} />;
            case 'select':
                return <SelectInput field={field} value={value} onChange={onChange} error={error} />;
            case 'textarea':
                return <TextAreaInput field={field} value={value} onChange={onChange} error={error} />;
            case 'checkbox':
                return <CheckboxGroup field={field} value={value} onChange={onChange} error={error} />;
            case 'radio':
                return <RadioGroup field={field} value={value} onChange={onChange} error={error} />;
            default:
                return <TextInput field={field} value={value} onChange={onChange} error={error} />;
        }
    };

    // Renders a row of fields
    const FormRow = ({ fields, formData, onChange, errors }) => {
        if (fields.length === 1) {
            return (
                <FieldRenderer
                    field={fields[0]}
                    value={formData[fields[0].id]}
                    onChange={onChange}
                    error={errors[fields[0].id]}
                />
            );
        }

        return (
            <div className="flex flex-col md:flex-row gap-4 mb-4">
                {fields.map(field => (
                    <div key={field.id} className="flex-1">
                        <FieldRenderer
                            field={field}
                            value={formData[field.id]}
                            onChange={onChange}
                            error={errors[field.id]}
                        />
                    </div>
                ))}
            </div>
        );
    };

    // Renders a complete section of the form
    const FormSection = ({ section, formData, onChange, errors }) => (
        <div className="mb-6 p-6 bg-white rounded-2xl shadow-sm border border-gray-200 transition-colors duration-200 relative overflow-hidden">
            <FloatingEmojiContainer count={10} />
            <h3 className="text-xl font-semibold mb-4 text-gray-800 flex items-center gap-2 relative z-10">
                {section.icon && <span className="text-2xl">{section.icon}</span>}
                {section.title}
            </h3>
            <div className="relative z-10">
                {section.rows.map((row, index) => (
                    <FormRow
                        key={index}
                        fields={row}
                        formData={formData}
                        onChange={onChange}
                        errors={errors}
                    />
                ))}
            </div>
        </div>
    );

    // The main component that renders the entire form
    const DynamicForm = ({ config, lang, toggleLanguage }) => {
        const [formData, setFormData] = useState({});
        const [errors, setErrors] = useState({});
        const [isSubmitting, setIsSubmitting] = useState(false);
        const t = TRANSLATIONS[lang]; // Shortcut for current translations

        // Initialize form data with default values on config change
        useEffect(() => {
            const initialData = {};
            config.sections.forEach(section => {
                section.rows.forEach(row => {
                    row.forEach(field => {
                        if (field.defaultValue !== undefined) {
                            initialData[field.id] = field.defaultValue;
                        } else if (field.type === 'checkbox') {
                            initialData[field.id] = [];
                        }
                    });
                });
            });
            setFormData(initialData);
        }, [config]);

        // Handles changes to form fields and clears related errors
        const handleFieldChange = (fieldId, value) => {
            setFormData(prev => ({
                ...prev,
                [fieldId]: value
            }));
            if (errors[fieldId]) {
                setErrors(prev => ({
                    ...prev,
                    [fieldId]: null
                }));
            }
        };

        // Validates the form data based on required fields and custom validation rules
        const validateForm = () => {
            const newErrors = {};
            let isValid = true;
            config.sections.forEach(section => {
                section.rows.forEach(row => {
                    row.forEach(field => {
                        const value = formData[field.id];
                        if (field.required && (!value || (Array.isArray(value) && value.length === 0) || (typeof value === 'string' && value.trim() === ''))) {
                            // Use translated error message
                            newErrors[field.id] = `${field.label} ${t.required}`;
                            isValid = false;
                        } else if (field.validation && value) {
                            const validationResult = field.validation(value);
                            if (validationResult !== true) {
                                newErrors[field.id] = validationResult;
                                isValid = false;
                            }
                        }
                    });
                });
            });
            setErrors(newErrors);
            return isValid;
        };

        // Handles form submission
        const handleSubmit = async (e) => {
            e.preventDefault();
            if (!validateForm()) {
                // Scroll to top or first error if validation fails
                document.getElementById('root').scrollIntoView({ behavior: 'smooth' });
                return;
            }
            setIsSubmitting(true);
            try {
                if (config.onSubmit) {
                    await config.onSubmit(formData);
                }
                if (window.Android && window.Android.onFormSubmit) {
                    window.Android.onFormSubmit(JSON.stringify(formData));
                }
                console.log('Form submitted:', formData);

                // --- CRITICAL CHANGE: Redirect to dashboard.html ---
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 500);

            } catch (error) {
                console.error('Submission error:', error);
            } finally {
                setIsSubmitting(false);
            }
        };

        // Handles the "go back" button click with a fade-out effect
        const handleGoBack = () => {
            const root = document.getElementById('root');
            root.classList.add('fade-out');
            setTimeout(() => {
                // Navigate back to the scale selection page
                window.location.href = 'choose_scale.html';
            }, 400);
        };

        return (
            <div className="w-full space-y-6">
                {/* Header Card - matching roadmap style */}
                <div className="bg-white p-8 rounded-b-3xl shadow-lg flex flex-col items-center text-center relative">
                    <div className="text-4xl mb-4">üå±</div>
                    <h1 className="text-3xl font-bold text-gray-800 mb-2">{config.title}</h1>
                    <p className="text-gray-500 mb-4">{config.description}</p>

                    {/* Language Toggle Button */}
                    <button
                        onClick={toggleLanguage}
                        className="absolute top-6 right-6 px-3 py-1 bg-green-100 text-green-700 text-sm font-semibold rounded-lg hover:bg-green-200 transition-colors z-10"
                    >
                        {t.langToggle}
                    </button>

                    {/* Go Back Button */}
                    <button
                        onClick={handleGoBack}
                        className="text-2xl text-gray-600 hover:text-gray-800 transition-colors absolute top-6 left-6"
                        title={t.backButton}
                    >
                        ‚Üê
                    </button>
                </div>

                {/* Form Container */}
                <div className="max-w-screen-md mx-auto p-6">
                    <form onSubmit={handleSubmit} className="space-y-6">
                        {config.sections.map((section, index) => (
                            <FormSection
                                key={index}
                                section={section}
                                formData={formData}
                                onChange={handleFieldChange}
                                errors={errors}
                            />
                        ))}

                        <div className="flex flex-col items-center justify-center w-full p-4">
                            <button
                                type="submit"
                                className="w-full sm:w-auto px-8 py-4 bg-green-600 text-white font-semibold rounded-full shadow-lg shadow-green-600/30 hover:bg-green-700 transition-colors duration-200 min-h-[48px] disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none"
                                disabled={isSubmitting}
                            >
                                {isSubmitting ? t.submittingText : t.submitText}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        );
    };

    // The main App component handles global state (language)
    const App = () => {
        const [lang, setLang] = useState('en'); // Default to English
        const [config, setConfig] = useState(FORM_CONFIGS.en);

        // Function to toggle language
        const toggleLanguage = () => {
            const newLang = lang === 'en' ? 'ml' : 'en';
            setLang(newLang);
            setConfig(FORM_CONFIGS[newLang]);
            // Update the page title for accessibility
            document.getElementById('pageTitle').textContent = TRANSLATIONS[newLang].pageTitle;
        };

        // Handles external config updates (if needed) - ensures the new config is loaded for the current language
        useEffect(() => {
            if (window.formConfig) {
                try {
                    // Note: External updates should follow the multilingual structure if applicable
                    const customConfig = JSON.parse(window.formConfig);
                    setConfig(customConfig[lang] || customConfig.en);
                } catch (error) {
                    console.error('Error parsing external form config:', error);
                }
            }
            // Initialize page title
            document.getElementById('pageTitle').textContent = TRANSLATIONS[lang].pageTitle;
        }, [lang]);

        return <DynamicForm config={config} lang={lang} toggleLanguage={toggleLanguage} />;
    };

    // Render the App component into the root element
    ReactDOM.render(<App />, document.getElementById('root'));

    // Global function to update the form configuration dynamically (retains for backward compatibility)
    window.updateFormConfig = (jsonConfig) => {
        try {
            // Note: This assumes external config might only provide 'en' or a monolithic structure.
            // For true dynamic updates with localization, the external system should pass a structured object like FORM_CONFIGS.
            window.formConfig = jsonConfig;
            // Force re-render to pick up new config.
            ReactDOM.render(<App />, document.getElementById('root'));
        } catch (error) {
            console.error('Error updating form config:', error);
        }
    };
</script>
</body>
</html>