<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n-key="page_title">Farming Roadmap</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F0FFF0; /* A very light, minty green */
            /* IMPORTANT: Add padding for the fixed bottom nav bar */
            padding-bottom: 80px;
        }

        /* --- NAVIGATION BAR STYLES --- */
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.75rem 0;
            cursor: pointer;
            transition: all 0.2s ease;
            border-top: 3px solid transparent;
            color: #4b5563; /* Default text color */
        }

        .nav-item:hover {
            background-color: #f0fdf4; /* Very light green on hover */
        }

        .nav-item.active {
            color: #16a34a; /* Primary green for active text/icon */
            border-top-color: #16a34a; /* Primary green border on top */
        }

        .nav-icon {
            font-size: 1.5rem;
            transition: transform 0.2s ease;
        }

        .nav-item.active .nav-icon {
            transform: scale(1.1);
        }

        .nav-label {
            font-size: 0.75rem;
            margin-top: 0.25rem;
            font-weight: 500;
        }
        /* --- END NAVIGATION BAR STYLES --- */


        /* Custom styles for animations and interactivity */
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .collapsible-content.expanded {
            max-height: 2000px; /* A large value to allow for smooth expansion */
            transition: max-height 0.5s ease-in;
        }
        .chevron {
            transition: transform 0.3s ease-in-out;
        }
        .chevron.rotated {
            transform: rotate(180deg);
        }
        .priority-high { @apply bg-red-100 text-red-700; }
        .priority-medium { @apply bg-yellow-100 text-yellow-700; }
        .priority-low { @apply bg-green-100 text-green-700; }
        .clickable:hover { @apply bg-green-50; }
        .clickable:active { transform: scale(0.98); }

        /* The custom message box */
        .message-box {
            position: fixed;
            top: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(52, 211, 153, 0.9);
            color: white;
            padding: 1rem 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
            text-align: center;
        }

        /* Styles for floating background emojis inside containers */
        .floating-emoji-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }
        .floating-emoji {
            position: absolute;
            opacity: 0.15;
            animation-name: float-and-wave-card;
            animation-iteration-count: infinite;
            animation-timing-function: linear;
            font-size: 2rem;
        }
        @keyframes float-and-wave-card {
            0% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(2rem, -1rem) scale(1.1); }
            50% { transform: translate(0, -2rem) scale(1.2); }
            75% { transform: translate(-2rem, -1rem) scale(1.1); }
            100% { transform: translate(0, 0) scale(1); }
        }

        .lang-toggle-button {
            background-color: #dcfce7;
            color: #16a34a;
            padding: 0.5rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .lang-toggle-button:hover {
            background-color: #bbf7d0;
        }
        .lang-toggle-button:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center">

<!-- Custom message box element -->
<div id="message-box" class="message-box"></div>

<div class="w-full space-y-6">

    <!-- Header Card -->
    <div class="bg-white p-8 rounded-b-3xl shadow-lg flex flex-col items-center text-center relative">
        <div class="absolute top-4 right-4 z-10">
            <button id="langToggleButton" onclick="toggleLanguage()" class="lang-toggle-button">ML</button>
        </div>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-green-600 mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
        </svg>
        <h1 class="text-3xl font-bold text-gray-800 mb-2" data-i18n-key="header_title">Farming Roadmap</h1>
        <p class="text-gray-500 mb-8" data-i18n-key="header_subtitle">Your personalized guide to a successful harvest.</p>

        <!-- Crop Info Box (Dynamic Content - will be updated by JS) -->
        <div class="bg-green-50 p-4 rounded-xl text-left w-full max-w-sm">
            <p class="text-sm text-gray-600 font-medium"><span data-i18n-key="crop_label">Crop:</span> <span id="cropName" class="font-semibold text-gray-800"></span></p>
            <p class="text-sm text-gray-600 font-medium"><span data-i18n-key="duration_label">Total Duration:</span> <span id="cropDuration"></span></p>
        </div>
    </div>

    <!-- Roadmap Container -->
    <div class="roadmap-container max-w-xl mx-auto space-y-6 px-4">
        <div id="roadmapPhases" class="space-y-6">
            <!-- Phases will be populated by JavaScript -->
        </div>
    </div>

</div>

<!-- AI Voice Bot Floating Button -->
<button id="voiceBotButton" onclick="startVoiceBot()"
        class="fixed bottom-20 right-6 p-4
               bg-green-600 text-white text-2xl
               rounded-full shadow-xl hover:bg-green-700
               transition-all duration-200 transform hover:scale-105 z-50">
    üé§
</button>

<!-- BOTTOM NAVIGATION BAR (Now includes Shop) -->
<div class="nav-bar">
    <div class="flex justify-around max-w-xl mx-auto">
        <div class="nav-item" onclick="navigateToDashboard()">
            <div class="nav-icon">üè†</div>
            <div class="nav-label">Home</div>
        </div>
        <!-- Set Roadmap as active since this is the Roadmap page -->
        <div class="nav-item active" onclick="navigateToRoadmap()">
            <div class="nav-icon">üó∫Ô∏è</div>
            <div class="nav-label">Roadmap</div>
        </div>
        <div class="nav-item" onclick="navigateToSchemes()">
            <div class="nav-icon">üìã</div>
            <div class="nav-label">Schemes</div>
        </div>
        <!-- New Shop Item -->
        <div class="nav-item" onclick="navigateToShop()">
            <div class="nav-icon">üõí</div>
            <div class="nav-label">Shop</div>
        </div>
    </div>
</div>
<!-- END BOTTOM NAVIGATION BAR -->

<script>
    // --- Internationalization (i18n) Configuration ---
    let currentLang = 'en';

    // Static translations for UI elements (labels and messages)
    const translations = {
        en: {
            page_title: "Farming Roadmap",
            header_title: "Farming Roadmap",
            header_subtitle: "Your personalized guide to a successful harvest.",
            crop_label: "Crop:",
            duration_label: "Total Duration:",
            priority_high: "High Priority",
            priority_medium: "Medium Priority",
            priority_low: "Low Priority",
            time_label: "Time:",
            target_label: "Target:",
            message_update_success: "Roadmap data updated successfully.",
            message_voice: "AI Voice Bot initiated. Speaking in current language.",
            message_dashboard: "Navigating to Dashboard...",
            message_roadmap: "Navigating to Roadmap (Already here).",
            message_schemes: "Navigating to Schemes...",
            message_shop: "Navigating to Shop...",
        },
        ml: { // Malayalam
            page_title: "‡¥ï‡µÉ‡¥∑‡¥ø ‡¥±‡µã‡¥°‡µç‡¥Æ‡¥æ‡¥™‡µç‡¥™‡µç",
            header_title: "‡¥ï‡µÉ‡¥∑‡¥ø ‡¥±‡µã‡¥°‡µç‡¥Æ‡¥æ‡¥™‡µç‡¥™‡µç",
            header_subtitle: "‡¥µ‡¥ø‡¥ú‡¥Ø‡¥ï‡¥∞‡¥Æ‡¥æ‡¥Ø ‡¥µ‡¥ø‡¥≥‡¥µ‡µÜ‡¥ü‡µÅ‡¥™‡µç‡¥™‡¥ø‡¥®‡¥æ‡¥Ø‡µÅ‡¥≥‡µç‡¥≥ ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥µ‡µç‡¥Ø‡¥ï‡µç‡¥§‡¥ø‡¥ó‡¥§ ‡¥ó‡µà‡¥°‡µç.",
            crop_label: "‡¥µ‡¥ø‡¥≥:",
            duration_label: "‡¥Ü‡¥ï‡µÜ ‡¥∏‡¥Æ‡¥Ø‡¥Ç:",
            priority_high: "‡¥â‡¥Ø‡µº‡¥®‡µç‡¥® ‡¥Æ‡µÅ‡µª‡¥ó‡¥£‡¥®",
            priority_medium: "‡¥á‡¥ü‡¥§‡µç‡¥§‡¥∞‡¥Ç ‡¥Æ‡µÅ‡µª‡¥ó‡¥£‡¥®",
            priority_low: "‡¥ï‡µÅ‡¥±‡¥û‡µç‡¥û ‡¥Æ‡µÅ‡µª‡¥ó‡¥£‡¥®",
            time_label: "‡¥∏‡¥Æ‡¥Ø‡¥Ç:",
            target_label: "‡¥≤‡¥ï‡µç‡¥∑‡µç‡¥Ø‡¥Ç:",
            message_update_success: "‡¥±‡µã‡¥°‡µç‡¥Æ‡¥æ‡¥™‡µç‡¥™‡µç ‡¥°‡¥æ‡¥±‡µç‡¥± ‡¥µ‡¥ø‡¥ú‡¥Ø‡¥ï‡¥∞‡¥Æ‡¥æ‡¥Ø‡¥ø ‡¥Ö‡¥™‡µç‚Äå‡¥°‡µá‡¥±‡µç‡¥±‡µç ‡¥ö‡µÜ‡¥Ø‡µç‚Äå‡¥§‡µÅ.",
            message_voice: "‡¥é.‡¥ê. ‡¥µ‡µã‡¥Ø‡¥ø‡¥∏‡µç ‡¥¨‡µã‡¥ü‡µç‡¥ü‡µç ‡¥Ü‡¥∞‡¥Ç‡¥≠‡¥ø‡¥ö‡µç‡¥ö‡µÅ. ‡¥®‡¥ø‡¥≤‡¥µ‡¥ø‡¥≤‡µÜ ‡¥≠‡¥æ‡¥∑‡¥Ø‡¥ø‡µΩ ‡¥∏‡¥Ç‡¥∏‡¥æ‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ.",
            message_dashboard: "‡¥°‡¥æ‡¥∑‡µç‚Äå‡¥¨‡µã‡µº‡¥°‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç ‡¥™‡µã‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ...",
            message_roadmap: "‡¥±‡µã‡¥°‡µç‚Äå‡¥Æ‡¥æ‡¥™‡µç‡¥™‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç ‡¥™‡µã‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ (‡¥á‡¥µ‡¥ø‡¥ü‡µÜ‡¥§‡µç‡¥§‡¥®‡µç‡¥®‡µÜ).",
            message_schemes: "‡¥™‡¥¶‡µç‡¥ß‡¥§‡¥ø‡¥ï‡¥≥‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç ‡¥™‡µã‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ...",
            message_shop: "‡¥∑‡µã‡¥™‡µç‡¥™‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç ‡¥™‡µã‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ...",
        }
    };

    // --- Dynamic Roadmap Data (English) ---
    const roadmapEN = {
        crop: {
            name: "Tomatoes (Cherry Variety)",
            icon: "üçÖ",
            totalDuration: "90-110 days",
        },
        phases: [
            { id: 1, title: "Site Preparation", icon: "üèóÔ∏è", duration: "Days 1-14", description: "2 weeks",
                tasks: [
                    { id: "prep1", title: "üß™ Soil Testing & Amendment", description: "Test and adjust soil pH to 6.0-6.8 for optimal tomato growth", estimatedTime: "2-3 hours", targetDays: "1-7", priority: "high" },
                    { id: "prep2", title: "üè° Bed Preparation", description: "Clear area, till soil 8-10 inches deep, create raised beds", estimatedTime: "4-6 hours", targetDays: "7-14", priority: "high" }
                ]
            },
            { id: 2, title: "Seeding & Planting", icon: "üå±", duration: "Days 15-28", description: "2 weeks",
                tasks: [
                    { id: "seed1", title: "üå± Start Seeds Indoors", description: "Start tomato seeds in trays 6-8 weeks before last frost date", estimatedTime: "1-2 hours", targetDays: "15-21", priority: "high" },
                    { id: "seed2", title: "üíß Setup Irrigation", description: "Install drip irrigation or soaker hoses for consistent watering", estimatedTime: "3-4 hours", targetDays: "15-25", priority: "medium" }
                ]
            },
            { id: 3, title: "Vegetative Growth", icon: "üåø", duration: "Days 29-56", description: "4 weeks",
                tasks: [
                    { id: "growth1", title: "üå± Transplant Seedlings", description: "Move hardened seedlings outdoors after last frost threat", estimatedTime: "2-3 hours", targetDays: "29-35", priority: "high" },
                    { id: "growth2", title: "ü•Ñ First Fertilization", description: "Apply balanced fertilizer to establish strong root system", estimatedTime: "30 minutes", targetDays: "35-45", priority: "medium" },
                    { id: "growth3", title: "üèóÔ∏è Install Supports", description: "Set up cages, stakes, or trellises for vine support", estimatedTime: "2-3 hours", targetDays: "35-50", priority: "high" }
                ]
            },
            { id: 4, title: "Flowering & Fruit Set", icon: "üå∏", duration: "Days 57-77", description: "3 weeks",
                tasks: [
                    { id: "flower1", title: "‚úÇÔ∏è Pruning & Maintenance", description: "Remove suckers and lower leaves touching soil", estimatedTime: "30-45 minutes weekly", targetDays: "57-77", priority: "high" },
                    { id: "flower2", title: "üå∏ Monitor Flowering", description: "Ensure good pollination and watch for early fruit development", estimatedTime: "10 minutes daily", targetDays: "57-70", priority: "medium" },
                    { id: "flower3", title: "üõ°Ô∏è Pest Prevention", description: "Apply preventive neem oil spray for common pests", estimatedTime: "20-30 minutes", targetDays: "57-77", priority: "high" }
                ]
            },
            { id: 5, title: "Harvest & Maintenance", icon: "üçÖ", duration: "Days 78-110", description: "4-5 weeks",
                tasks: [
                    { id: "harvest1", title: "üçÖ Begin Harvesting", description: "Pick tomatoes when they show first blush of color", estimatedTime: "15-30 minutes daily", targetDays: "78-85", priority: "high" },
                    { id: "harvest2", title: "üçÖ Continuous Care", description: "Maintain consistent watering and fertilization schedule", estimatedTime: "20 minutes weekly", targetDays: "78-100", priority: "medium" },
                    { id: "harvest3", title: "üì¶ Storage & Processing", description: "Properly store harvested tomatoes and plan preservation", estimatedTime: "Variable", targetDays: "78-110", priority: "low" }
                ]
            }
        ]
    };

    // --- Dynamic Roadmap Data (Malayalam) ---
    const roadmapML = {
        crop: {
            name: "‡¥§‡¥ï‡µç‡¥ï‡¥æ‡¥≥‡¥ø (‡¥ö‡µÜ‡¥±‡¥ø ‡¥á‡¥®‡¥Ç)",
            icon: "üçÖ",
            totalDuration: "90-110 ‡¥¶‡¥ø‡¥µ‡¥∏‡¥Ç",
        },
        phases: [
            { id: 1, title: "‡¥∏‡µç‡¥•‡¥≤‡¥Ç ‡¥í‡¥∞‡µÅ‡¥ï‡µç‡¥ï‡µΩ", icon: "üèóÔ∏è", duration: "1-14 ‡¥¶‡¥ø‡¥µ‡¥∏‡¥ô‡µç‡¥ô‡µæ", description: "2 ‡¥Ü‡¥¥‡µç‡¥ö",
                tasks: [
                    { id: "prep1", title: "üß™ ‡¥Æ‡¥£‡µç‡¥£‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥™‡¥∞‡¥ø‡¥∂‡µã‡¥ß‡¥®‡¥Ø‡µÅ‡¥Ç ‡¥™‡¥∞‡¥ø‡¥∑‡µç‡¥ï‡¥∞‡¥£‡¥µ‡µÅ‡¥Ç", description: "‡¥§‡¥ï‡µç‡¥ï‡¥æ‡¥≥‡¥ø ‡¥µ‡¥≥‡µº‡¥ö‡µç‡¥ö‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µç ‡¥Ö‡¥®‡µÅ‡¥Ø‡µã‡¥ú‡µç‡¥Ø‡¥Æ‡¥æ‡¥Ø $6.0-6.8$ ‡¥™‡¥ø.‡¥é‡¥ö‡µç‡¥ö‡µç. ‡¥®‡¥ø‡¥≤‡¥µ‡¥æ‡¥∞‡¥§‡µç‡¥§‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç ‡¥Æ‡¥£‡µç‡¥£‡µç ‡¥™‡¥∞‡¥ø‡¥∂‡µã‡¥ß‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï‡¥Ø‡µÅ‡¥Ç ‡¥ï‡µç‡¥∞‡¥Æ‡µÄ‡¥ï‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï‡¥Ø‡µÅ‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï.", estimatedTime: "2-3 ‡¥Æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡µÇ‡µº", targetDays: "1-7", priority: "high" },
                    { id: "prep2", title: "üè° ‡¥ï‡µÉ‡¥∑‡¥ø‡¥Ø‡¥ø‡¥ü‡¥Ç ‡¥í‡¥∞‡µÅ‡¥ï‡µç‡¥ï‡µΩ", description: "‡¥∏‡µç‡¥•‡¥≤‡¥Ç ‡¥µ‡µÉ‡¥§‡µç‡¥§‡¥ø‡¥Ø‡¥æ‡¥ï‡µç‡¥ï‡µÅ‡¥ï, ‡¥Æ‡¥£‡µç‡¥£‡µç $8-10$ ‡¥á‡¥û‡µç‡¥ö‡µç ‡¥Ü‡¥¥‡¥§‡µç‡¥§‡¥ø‡µΩ ‡¥â‡¥¥‡µÅ‡¥ï‡µÅ‡¥ï, ‡¥â‡¥Ø‡µº‡¥§‡µç‡¥§‡¥ø‡¥Ø ‡¥§‡¥ü‡¥ô‡µç‡¥ô‡µæ ‡¥â‡¥£‡µç‡¥ü‡¥æ‡¥ï‡µç‡¥ï‡µÅ‡¥ï.", estimatedTime: "4-6 ‡¥Æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡µÇ‡µº", targetDays: "7-14", priority: "high" }
                ]
            },
            { id: 2, title: "‡¥µ‡¥ø‡¥§‡µç‡¥§‡µÅ‡¥ï‡µæ ‡¥®‡¥ü‡¥≤‡µÅ‡¥Ç ‡¥™‡¥±‡¥ø‡¥ö‡µç‡¥ö‡µÅ‡¥®‡¥ü‡¥≤‡µÅ‡¥Ç", icon: "üå±", duration: "15-28 ‡¥¶‡¥ø‡¥µ‡¥∏‡¥ô‡µç‡¥ô‡µæ", description: "2 ‡¥Ü‡¥¥‡µç‡¥ö",
                tasks: [
                    { id: "seed1", title: "üå± ‡¥µ‡¥ø‡¥§‡µç‡¥§‡µÅ‡¥ï‡µæ ‡¥µ‡µÄ‡¥ü‡¥ø‡¥®‡µÅ‡¥≥‡µç‡¥≥‡¥ø‡µΩ ‡¥®‡¥ü‡µÅ‡¥ï", description: "‡¥§‡¥ï‡µç‡¥ï‡¥æ‡¥≥‡¥ø ‡¥µ‡¥ø‡¥§‡µç‡¥§‡µÅ‡¥ï‡µæ ‡¥Ö‡¥µ‡¥∏‡¥æ‡¥® ‡¥Æ‡¥û‡µç‡¥û‡µÅ‡¥µ‡µÄ‡¥¥‡µç‡¥ö ‡¥§‡µÄ‡¥Ø‡¥§‡¥ø‡¥ï‡µç‡¥ï‡µç $6-8$ ‡¥Ü‡¥¥‡µç‡¥ö ‡¥Æ‡µÅ‡¥Æ‡µç‡¥™‡µç ‡¥ü‡µç‡¥∞‡µá‡¥ï‡¥≥‡¥ø‡µΩ ‡¥®‡¥ü‡µÅ‡¥ï.", estimatedTime: "1-2 ‡¥Æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡µÇ‡µº", targetDays: "15-21", priority: "high" },
                    { id: "seed2", title: "üíß ‡¥ú‡¥≤‡¥∏‡µá‡¥ö‡¥®‡¥Ç ‡¥∏‡¥ú‡µç‡¥ú‡¥Æ‡¥æ‡¥ï‡µç‡¥ï‡µÅ‡¥ï", description: "‡¥∏‡µç‡¥•‡¥ø‡¥∞‡¥Æ‡¥æ‡¥Ø‡¥ø ‡¥®‡¥®‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡¥ø‡¥®‡¥æ‡¥Ø‡¥ø ‡¥°‡µç‡¥∞‡¥ø‡¥™‡µç‡¥™‡µç ‡¥á‡¥±‡¥ø‡¥ó‡µá‡¥∑‡µª ‡¥Ö‡¥≤‡µç‡¥≤‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥∏‡µã‡¥ï‡µç‡¥ï‡µº ‡¥π‡µã‡¥∏‡µÅ‡¥ï‡µæ ‡¥∏‡µç‡¥•‡¥æ‡¥™‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.", estimatedTime: "3-4 ‡¥Æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡µÇ‡µº", targetDays: "15-25", priority: "medium" }
                ]
            },
            { id: 3, title: "‡¥ï‡¥æ‡¥Ø‡¥ø‡¥ï ‡¥µ‡¥≥‡µº‡¥ö‡µç‡¥ö", icon: "üåø", duration: "29-56 ‡¥¶‡¥ø‡¥µ‡¥∏‡¥ô‡µç‡¥ô‡µæ", description: "4 ‡¥Ü‡¥¥‡µç‡¥ö",
                tasks: [
                    { id: "growth1", title: "üå± ‡¥§‡µà‡¥ï‡µæ ‡¥™‡¥±‡¥ø‡¥ö‡µç‡¥ö‡µÅ‡¥®‡¥ü‡µÅ‡¥ï", description: "‡¥Ö‡¥µ‡¥∏‡¥æ‡¥® ‡¥Æ‡¥û‡µç‡¥û‡µÅ‡¥µ‡µÄ‡¥¥‡µç‡¥ö ‡¥≠‡µÄ‡¥∑‡¥£‡¥ø‡¥ï‡µç‡¥ï‡µç ‡¥∂‡µá‡¥∑‡¥Ç ‡¥§‡µà‡¥ï‡µæ ‡¥™‡µÅ‡¥±‡¥§‡µç‡¥§‡µá‡¥ï‡µç‡¥ï‡µç ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡µÅ‡¥ï.", estimatedTime: "2-3 ‡¥Æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡µÇ‡µº", targetDays: "29-35", priority: "high" },
                    { id: "growth2", title: "ü•Ñ ‡¥Ü‡¥¶‡µç‡¥Ø ‡¥µ‡¥≥‡¥™‡µç‡¥∞‡¥Ø‡µã‡¥ó‡¥Ç", description: "‡¥∂‡¥ï‡µç‡¥§‡¥Æ‡¥æ‡¥Ø ‡¥µ‡µá‡¥∞‡µÅ‡¥ï‡µæ ‡¥∏‡µç‡¥•‡¥æ‡¥™‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡¥ø‡¥®‡µç ‡¥∏‡¥Æ‡µÄ‡¥ï‡µÉ‡¥§ ‡¥µ‡¥≥‡¥Ç ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï.", estimatedTime: "30 ‡¥Æ‡¥ø‡¥®‡¥ø‡¥±‡µç‡¥±‡µç", targetDays: "35-45", priority: "medium" },
                    { id: "growth3", title: "üèóÔ∏è ‡¥§‡¥æ‡¥ô‡µç‡¥ô‡µÅ‡¥ï‡µæ ‡¥∏‡µç‡¥•‡¥æ‡¥™‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï", description: "‡¥µ‡¥≥‡µç‡¥≥‡¥ø‡¥ï‡µæ‡¥ï‡µç‡¥ï‡µç ‡¥§‡¥æ‡¥ô‡µç‡¥ô‡¥æ‡¥Ø‡¥ø ‡¥ï‡µÇ‡¥ü‡µÅ‡¥ï‡µæ, ‡¥ï‡µã‡¥≤‡µÅ‡¥ï‡µæ ‡¥Ö‡¥≤‡µç‡¥≤‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥ü‡µç‡¥∞‡µÜ‡¥≤‡µç‡¥≤‡¥ø‡¥∏‡µÅ‡¥ï‡µæ ‡¥∏‡µç‡¥•‡¥æ‡¥™‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.", estimatedTime: "2-3 ‡¥Æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡µÇ‡µº", targetDays: "35-50", priority: "high" }
                ]
            },
            { id: 4, title: "‡¥™‡µÇ‡¥µ‡¥ø‡¥ü‡¥≤‡µÅ‡¥Ç ‡¥ï‡¥æ‡¥Ø‡µç‡¥´‡¥≤‡¥µ‡µÅ‡¥Ç", icon: "üå∏", duration: "57-77 ‡¥¶‡¥ø‡¥µ‡¥∏‡¥ô‡µç‡¥ô‡µæ", description: "3 ‡¥Ü‡¥¥‡µç‡¥ö",
                tasks: [
                    { id: "flower1", title: "‚úÇÔ∏è ‡¥ï‡¥Æ‡µç‡¥™‡µç ‡¥µ‡µÜ‡¥ü‡µç‡¥ü‡¥≤‡µÅ‡¥Ç ‡¥™‡¥∞‡¥ø‡¥™‡¥æ‡¥≤‡¥®‡¥µ‡µÅ‡¥Ç", description: "‡¥ö‡¥ø‡¥Æ‡µç‡¥™‡µÅ‡¥ï‡¥≥‡µÅ‡¥Ç ‡¥Æ‡¥£‡µç‡¥£‡¥ø‡µΩ ‡¥§‡¥ü‡µç‡¥ü‡µÅ‡¥®‡µç‡¥® ‡¥§‡¥æ‡¥¥‡µç‡¥®‡µç‡¥® ‡¥á‡¥≤‡¥ï‡¥≥‡µÅ‡¥Ç ‡¥®‡µÄ‡¥ï‡µç‡¥ï‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï.", estimatedTime: "‡¥Ü‡¥¥‡µç‡¥ö‡¥Ø‡¥ø‡µΩ 30-45 ‡¥Æ‡¥ø‡¥®‡¥ø‡¥±‡µç‡¥±‡µç", targetDays: "57-77", priority: "high" },
                    { id: "flower2", title: "üå∏ ‡¥™‡µÇ‡¥µ‡¥ø‡¥ü‡µΩ ‡¥®‡¥ø‡¥∞‡µÄ‡¥ï‡µç‡¥∑‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï", description: "‡¥®‡¥≤‡µç‡¥≤ ‡¥™‡¥∞‡¥æ‡¥ó‡¥£‡¥Ç ‡¥â‡¥±‡¥™‡µç‡¥™‡¥æ‡¥ï‡µç‡¥ï‡µÅ‡¥ï‡¥Ø‡µÅ‡¥Ç ‡¥Ü‡¥¶‡µç‡¥Ø‡¥ï‡¥æ‡¥≤ ‡¥ï‡¥æ‡¥Ø‡µç‡¥ï‡µæ ‡¥∂‡µç‡¥∞‡¥¶‡µç‡¥ß‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï‡¥Ø‡µÅ‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï.", estimatedTime: "‡¥¶‡¥ø‡¥µ‡¥∏‡¥µ‡µÅ‡¥Ç 10 ‡¥Æ‡¥ø‡¥®‡¥ø‡¥±‡µç‡¥±‡µç", targetDays: "57-70", priority: "medium" },
                    { id: "flower3", title: "üõ°Ô∏è ‡¥ï‡µÄ‡¥ü‡¥®‡¥ø‡¥Ø‡¥®‡µç‡¥§‡µç‡¥∞‡¥£‡¥Ç", description: "‡¥∏‡¥æ‡¥ß‡¥æ‡¥∞‡¥£ ‡¥ï‡µÄ‡¥ü‡¥ô‡µç‡¥ô‡µæ‡¥ï‡µç‡¥ï‡¥æ‡¥Ø‡¥ø ‡¥µ‡µá‡¥™‡µç‡¥™‡µÜ‡¥£‡µç‡¥£ ‡¥∏‡µç‡¥™‡µç‡¥∞‡µá ‡¥™‡µç‡¥∞‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.", estimatedTime: "20-30 ‡¥Æ‡¥ø‡¥®‡¥ø‡¥±‡µç‡¥±‡µç", targetDays: "57-77", priority: "high" }
                ]
            },
            { id: 5, title: "‡¥µ‡¥ø‡¥≥‡¥µ‡µÜ‡¥ü‡µÅ‡¥™‡µç‡¥™‡µÅ‡¥Ç ‡¥™‡¥∞‡¥ø‡¥™‡¥æ‡¥≤‡¥®‡¥µ‡µÅ‡¥Ç", icon: "üçÖ", duration: "78-110 ‡¥¶‡¥ø‡¥µ‡¥∏‡¥ô‡µç‡¥ô‡µæ", description: "4-5 ‡¥Ü‡¥¥‡µç‡¥ö",
                tasks: [
                    { id: "harvest1", title: "üçÖ ‡¥µ‡¥ø‡¥≥‡¥µ‡µÜ‡¥ü‡µÅ‡¥™‡µç‡¥™‡µç ‡¥Ü‡¥∞‡¥Ç‡¥≠‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï", description: "‡¥§‡¥ï‡µç‡¥ï‡¥æ‡¥≥‡¥ø‡¥ï‡µç‡¥ï‡µç ‡¥Ü‡¥¶‡µç‡¥Ø‡¥§‡µç‡¥§‡µÜ ‡¥ö‡µÅ‡¥µ‡¥™‡µç‡¥™‡µç ‡¥®‡¥ø‡¥±‡¥Ç ‡¥µ‡¥∞‡µÅ‡¥Æ‡µç‡¥™‡µã‡µæ ‡¥™‡¥±‡¥ø‡¥ö‡µç‡¥ö‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï.", estimatedTime: "‡¥¶‡¥ø‡¥µ‡¥∏‡¥µ‡µÅ‡¥Ç 15-30 ‡¥Æ‡¥ø‡¥®‡¥ø‡¥±‡µç‡¥±‡µç", targetDays: "78-85", priority: "high" },
                    { id: "harvest2", title: "üçÖ ‡¥§‡µÅ‡¥ü‡µº ‡¥™‡¥∞‡¥ø‡¥ö‡¥∞‡¥£‡¥Ç", description: "‡¥∏‡µç‡¥•‡¥ø‡¥∞‡¥Æ‡¥æ‡¥Ø ‡¥®‡¥®‡¥µ‡µÅ‡¥Ç ‡¥µ‡¥≥‡¥™‡µç‡¥∞‡¥Ø‡µã‡¥ó‡¥µ‡µÅ‡¥Ç ‡¥®‡¥ø‡¥≤‡¥®‡¥ø‡µº‡¥§‡µç‡¥§‡µÅ‡¥ï.", estimatedTime: "‡¥Ü‡¥¥‡µç‡¥ö‡¥Ø‡¥ø‡µΩ 20 ‡¥Æ‡¥ø‡¥®‡¥ø‡¥±‡µç‡¥±‡µç", targetDays: "78-100", priority: "medium" },
                    { id: "harvest3", title: "üì¶ ‡¥∏‡¥Ç‡¥≠‡¥∞‡¥£‡¥µ‡µÅ‡¥Ç ‡¥∏‡¥Ç‡¥∏‡µç‡¥ï‡¥∞‡¥£‡¥µ‡µÅ‡¥Ç", description: "‡¥µ‡¥ø‡¥≥‡¥µ‡µÜ‡¥ü‡µÅ‡¥§‡µç‡¥§ ‡¥§‡¥ï‡µç‡¥ï‡¥æ‡¥≥‡¥ø ‡¥∂‡¥∞‡¥ø‡¥Ø‡¥æ‡¥Ø ‡¥∞‡µÄ‡¥§‡¥ø‡¥Ø‡¥ø‡µΩ ‡¥∏‡µÇ‡¥ï‡µç‡¥∑‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï‡¥Ø‡µÅ‡¥Ç ‡¥∏‡¥Ç‡¥∞‡¥ï‡µç‡¥∑‡¥£‡¥Ç ‡¥Ü‡¥∏‡µÇ‡¥§‡µç‡¥∞‡¥£‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï‡¥Ø‡µÅ‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï.", estimatedTime: "‡¥µ‡µç‡¥Ø‡¥§‡µç‡¥Ø‡¥æ‡¥∏‡¥™‡µç‡¥™‡µÜ‡¥ü‡¥æ‡¥Ç", targetDays: "78-110", priority: "low" }
                ]
            }
        ]
    };

    // Initial data set
    let roadmapData = roadmapEN;

    // --- Core i18n Functions ---

    function translatePage() {
        // 1. Update static elements via data-i18n-key
        document.querySelectorAll('[data-i18n-key]').forEach(element => {
            const key = element.getAttribute('data-i18n-key');
            if (translations[currentLang][key]) {
                element.textContent = translations[currentLang][key];
            }
        });

        // 2. Select the correct roadmap data
        roadmapData = currentLang === 'en' ? roadmapEN : roadmapML;

        // 3. Re-render dynamic content (Roadmap)
        renderRoadmap();

        // 4. Update the language toggle button text
        const toggleButton = document.getElementById('langToggleButton');
        if (toggleButton) {
            toggleButton.textContent = currentLang === 'en' ? 'ML' : 'EN';
        }

        // 5. Update the <title> tag
        document.title = translations[currentLang].page_title;
    }

    function toggleLanguage() {
        currentLang = currentLang === 'en' ? 'ml' : 'en';
        translatePage();
    }

    // Custom message function to provide user feedback
    function showMessage(key, duration = 3000) {
        const messageBox = document.getElementById('message-box');
        // Note: The showMessage logic is primarily for feedback/debugging,
        // but the actual navigation will immediately change the page location.
        messageBox.textContent = translations[currentLang][key] || key;
        messageBox.style.display = 'block';
        setTimeout(() => {
            messageBox.style.display = 'none';
        }, duration);
    }


    // Renders the full roadmap based on the current language data (roadmapData)
    function renderRoadmap() {
        const container = document.getElementById('roadmapPhases');
        const cropNameElement = document.getElementById('cropName');
        const cropDurationElement = document.getElementById('cropDuration');

        if (!container || !cropNameElement || !cropDurationElement) return;

        // Update header crop info
        cropNameElement.textContent = roadmapData.crop.name;
        cropDurationElement.textContent = roadmapData.crop.totalDuration;

        container.innerHTML = ''; // Clear previous content

        // Render phases and tasks
        roadmapData.phases.forEach(phase => {
            const phaseElement = document.createElement('div');
            // Ensure phase cards have position: relative and overflow: hidden for emojis to work inside
            phaseElement.className = 'phase-card bg-white p-6 rounded-2xl shadow-sm border border-gray-200 transition-colors duration-200 cursor-pointer clickable relative overflow-hidden';

            // Add a container for the floating emojis at the top of the card
            const emojiContainer = document.createElement('div');
            emojiContainer.className = 'floating-emoji-container';
            phaseElement.appendChild(emojiContainer);

            // Populate this container with emojis
            populateContainerWithEmojis(emojiContainer, 10); // Adjust number for visual density

            // Phase Header with interactive element
            const headerContent = document.createElement('div');
            headerContent.className = 'flex items-center justify-between z-10 relative'; // z-index ensures content is above emojis
            headerContent.setAttribute('data-id', phase.id);
            headerContent.innerHTML = `
                <div class="flex items-center space-x-4">
                    <div class="text-3xl">${phase.icon}</div>
                    <div>
                        <h3 class="text-xl font-semibold text-gray-800">${phase.title}</h3>
                        <p class="text-sm text-gray-500">${phase.duration} ‚Ä¢ ${phase.description}</p>
                    </div>
                </div>
                <svg class="chevron h-6 w-6 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            `;
            phaseElement.appendChild(headerContent);

            const collapsibleContent = document.createElement('div');
            collapsibleContent.className = 'collapsible-content space-y-4 mt-4 relative z-10';

            // Render tasks inside the collapsible content
            phase.tasks.forEach(task => {
                const taskCard = document.createElement('div');
                const priorityKey = `priority_${task.priority.toLowerCase()}`;
                const priorityClass = `priority-${task.priority.toLowerCase()}`;
                const priorityLabel = translations[currentLang][priorityKey] || task.priority;

                // Add position:relative and overflow:hidden to task cards too
                taskCard.className = 'task-card bg-slate-50 p-4 rounded-xl border border-gray-100 shadow-sm relative overflow-hidden';

                const taskEmojiContainer = document.createElement('div');
                taskEmojiContainer.className = 'floating-emoji-container';
                taskCard.appendChild(taskEmojiContainer);
                populateContainerWithEmojis(taskEmojiContainer, 5); // Fewer emojis for smaller cards

                taskCard.innerHTML += `
                    <h4 class="text-md font-semibold text-gray-700 relative z-10">${task.title}</h4>
                    <p class="text-sm text-gray-600 my-2 relative z-10">${task.description}</p>
                    <div class="flex items-center justify-between text-xs text-gray-400 mt-3 relative z-10">
                        <span class="font-medium">${translations[currentLang].time_label} ${task.estimatedTime}</span>
                        <span class="font-medium">${translations[currentLang].target_label} ${task.targetDays}</span>
                    </div>
                    <div class="text-xs font-semibold px-2 py-1 rounded-full ${priorityClass} mt-2 inline-block relative z-10">${priorityLabel}</div>
                `;
                collapsibleContent.appendChild(taskCard);
            });

            phaseElement.appendChild(collapsibleContent);

            // Add event listener for collapsing/expanding
            headerContent.addEventListener('click', (event) => {
                const content = phaseElement.querySelector('.collapsible-content');
                const chevron = phaseElement.querySelector('.chevron');
                if (content.classList.contains('expanded')) {
                    content.classList.remove('expanded');
                    chevron.classList.remove('rotated');
                } else {
                    content.classList.add('expanded');
                    chevron.classList.add('rotated');
                }
            });
            container.appendChild(phaseElement);
        });
    }

    // --- Navigation Bar Functions (UPDATED FOR NAVIGATION) ---

    function navigateToDashboard() {
        // Navigates to the Dashboard page as requested: dashboard.html
        console.log("Navigating to dashboard.html");
        window.location.href = 'dashboard.html';
    }

    function navigateToRoadmap() {
        // Navigates to the specific Roadmap page as requested: small_scale_roadmap.html
        console.log("Navigating to small_scale_roadmap.html");
        window.location.href = 'small_scale_roadmap.html';
    }

    function navigateToSchemes() {
        // Navigates to the Government Schemes page as requested: gov_schemes.html
        console.log("Navigating to gov_schemes.html");
        window.location.href = 'gov_schemes.html';
    }

    function navigateToShop() {
        // Navigates to the Shop page as requested: shopping.html
        console.log("Navigating to shopping.html");
        window.location.href = 'shopping.html';
    }

    // Add function to handle the active state change for the nav bar
    function setupNavBarInteraction() {
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                // Remove 'active' from all items
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                // Add 'active' to the clicked item
                this.classList.add('active');
            });
        });
    }

    // --- Action Functions ---

    // Function for the AI Voice Bot
    function startVoiceBot() {
        if (window.Android && window.Android.startVoiceBot) {
            window.Android.startVoiceBot(currentLang); // Optionally pass current language to native app
        } else {
            showMessage('message_voice');
        }
    }

    // Public API for updating the roadmap data (now handles language switch)
    window.updateRoadmapData = function(newData, lang = 'en') {
        try {
            const dataToSet = typeof newData === 'string' ? JSON.parse(newData) : newData;

            if (lang === 'ml') {
                roadmapML.phases = dataToSet.phases;
                roadmapML.crop = dataToSet.crop;
            } else {
                roadmapEN.phases = dataToSet.phases;
                roadmapEN.crop = dataToSet.crop;
            }

            // If the current displayed language matches the updated data, re-render
            if (currentLang === lang) {
                roadmapData = currentLang === 'en' ? roadmapEN : roadmapML;
                renderRoadmap();
            }
            showMessage('message_update_success');
            return true;
        } catch (e) {
            console.error('Error updating roadmap data:', e);
            return false;
        }
    };

    // --- Background Emoji Functions ---
    function createEmoji(container) {
        const emojis = ['ü•ï', 'üçé', 'üçì', 'ü•¨', 'ü•¶', 'üåΩ', 'üçä'];
        const emoji = document.createElement('span');
        emoji.className = 'floating-emoji';
        emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];

        const startX = Math.random() * 100;
        const startY = Math.random() * 100;
        const size = 1.5 + Math.random() * 1.5;
        const duration = 10 + Math.random() * 5;

        emoji.style.left = `${startX}%`;
        emoji.style.top = `${startY}%`;
        emoji.style.fontSize = `${size}rem`;
        emoji.style.animationDuration = `${duration}s`;
        emoji.style.animationDelay = `${Math.random() * duration}s`;

        container.appendChild(emoji);
    }

    function populateContainerWithEmojis(container, count) {
        for (let i = 0; i < count; i++) {
            createEmoji(container);
        }
    }

    // Initial render when the page loads
    document.addEventListener('DOMContentLoaded', () => {
        // Start in English and translate the page
        translatePage();
        // Setup the nav bar click listener
        setupNavBarInteraction();
    });
</script>
</body>
</html>
