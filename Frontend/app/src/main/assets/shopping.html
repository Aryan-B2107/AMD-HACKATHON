<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Farming Shop</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F0FFF0;
            padding-bottom: 80px;
            /* Added padding-top to account for the new fixed back button and language toggle */
            padding-top: 5rem;
        }

        .floating-emoji-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }
        .floating-emoji {
            position: absolute;
            opacity: 0.15;
            animation-name: float-and-wave-card;
            animation-iteration-count: infinite;
            animation-timing-function: linear;
            font-size: 2rem;
        }

        @keyframes float-and-wave-card {
            0% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(2rem, -1rem) scale(1.1); }
            50% { transform: translate(0, -2rem) scale(1.2); }
            75% { transform: translate(-2rem, -1rem) scale(1.1); }
            100% { transform: translate(0, 0) scale(1); }
        }

        .clickable:hover {
            background-color: #f0fdf4;
            transform: translateY(-4px);
            transition: all 0.3s ease;
        }
        .clickable:active {
            transform: scale(0.98);
        }

        .message-box {
            position: fixed;
            top: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(52, 211, 153, 0.9);
            color: white;
            padding: 1rem 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
            text-align: center;
        }

        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.75rem 0;
            cursor: pointer;
            transition: all 0.2s ease;
            border-top: 3px solid transparent;
        }

        .nav-item:hover {
            background-color: #f0fdf4;
        }

        .nav-item.active {
            color: #16a34a;
            border-top-color: #16a34a;
        }

        .nav-item.active .nav-icon {
            transform: scale(1.1);
        }

        .nav-icon {
            font-size: 1.5rem;
            transition: transform 0.2s ease;
        }

        .nav-label {
            font-size: 0.75rem;
            margin-top: 0.25rem;
            font-weight: 500;
        }

        .shop-card {
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: block;
        }

        .shop-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.08);
        }

        .shop-card:active {
            transform: translateY(-2px);
        }

        .shop-image {
            width: 100%;
            height: 140px;
            object-fit: cover;
            border-radius: 1rem;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
        }

        .category-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: #dcfce7;
            color: #166534;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .external-link-icon {
            display: inline-block;
            transition: transform 0.2s ease;
        }

        .shop-card:hover .external-link-icon {
            transform: translateX(4px);
        }
    </style>
</head>
<body class="min-h-screen">

<div id="message-box" class="message-box"></div>

<!-- Custom Fixed Controls - Back Button (LEFT) -->
<button
        onclick="window.location.href = 'dashboard.html';"
        class="fixed top-4 left-4 z-20 p-3 bg-white rounded-full shadow-xl text-green-700 hover:bg-green-50 transition transform active:scale-95"
        id="backButton"
        title="Back to Dashboard"
>
    <!-- Simple back arrow SVG icon -->
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
    </svg>
</button>

<!-- Language Toggle Button (RIGHT) -->
<button
        onclick="toggleLanguage()"
        class="fixed top-4 right-4 z-20 p-3 px-4 bg-green-100 rounded-full shadow-xl text-green-800 font-semibold hover:bg-green-200 transition transform active:scale-95 text-sm"
        id="langToggle"
        title="Switch Language"
>
    EN
</button>


<div class="w-full max-w-md mx-auto space-y-4 p-4">

    <!-- Header Card -->
    <div class="bg-white p-6 rounded-3xl shadow-lg relative overflow-hidden mt-4">
        <div class="floating-emoji-container" id="headerEmojis"></div>
        <div class="relative z-10">
            <div class="flex items-center justify-between mb-2">
                <div>
                    <!-- The header title is shifted slightly right to compensate for the fixed back button -->
                    <h1 class="text-2xl font-bold text-gray-800 ml-8" id="headerTitle">Farm Shop üõí</h1>
                    <p class="text-sm text-gray-500 ml-8" id="headerSubtitle">Buy bulk farming supplies online</p>
                </div>
                <div class="text-5xl">üåæ</div>
            </div>
            <div class="bg-green-50 p-3 rounded-xl mt-4">
                <p class="text-xs text-green-800">
                    <span id="tipPrefix" class="font-semibold">üí° Tip:</span>
                    <span id="tipText">Compare prices across platforms for best deals!</span>
                </p>
            </div>
        </div>
    </div>

    <!-- Shopping Platforms Section -->
    <div class="space-y-3" id="shopsContainer">
        <!-- Shop cards will be populated by JavaScript -->
    </div>

</div>

<!-- Bottom Navigation Bar -->
<div class="nav-bar">
    <div class="flex justify-around max-w-md mx-auto">
        <div class="nav-item" onclick="navigateToDashboard()">
            <div class="nav-icon">üè†</div>
            <div class="nav-label" id="navHome">Home</div>
        </div>
        <div class="nav-item" onclick="navigateToRoadmap()">
            <div class="nav-icon">üó∫Ô∏è</div>
            <div class="nav-label" id="navRoadmap">Roadmap</div>
        </div>
        <div class="nav-item" onclick="navigateToSchemes()">
            <div class="nav-icon">üìã</div>
            <div class="nav-label" id="navSchemes">Schemes</div>
        </div>
        <div class="nav-item active" onclick="navigateToShopping()">
            <div class="nav-icon">üõí</div>
            <div class="nav-label" id="navShop">Shop</div>
        </div>
    </div>
</div>

<script>
    // --- Global Language and Translation Setup ---
    let currentLang = localStorage.getItem('appLang') || 'en'; // Default to English

    const translations = {
        en: {
            title: "Farming Shop",
            back_to_dashboard: "Back to Dashboard",
            header_title: "Farm Shop üõí",
            header_subtitle: "Buy bulk farming supplies online",
            tip_prefix: "üí° Tip:",
            tip_text: "Compare prices across platforms for best deals!",
            nav_home: "Home",
            nav_roadmap: "Roadmap",
            nav_schemes: "Schemes",
            nav_shop: "Shop",
            message_on_shop: "Already on Shopping page"
        },
        ml: {
            title: "‡¥ï‡µÉ‡¥∑‡¥ø ‡¥ï‡¥ü", // Krishi Kada
            back_to_dashboard: "‡¥°‡¥æ‡¥∑‡µç‡¥¨‡µá‡¥æ‡µº‡¥°‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç ‡¥§‡¥ø‡¥∞‡¥ø‡¥ï‡µÜ", // Dashboardilekku Thirike
            header_title: "‡¥ï‡µÉ‡¥∑‡¥ø ‡¥ï‡¥ü üõí",
            header_subtitle: "‡¥µ‡µª‡¥§‡µã‡¥§‡¥ø‡µΩ ‡¥ï‡µÉ‡¥∑‡¥ø ‡¥∏‡¥æ‡¥ß‡¥®‡¥ô‡µç‡¥ô‡µæ ‡¥ì‡µ∫‡¥≤‡µà‡¥®‡¥æ‡¥Ø‡¥ø ‡¥µ‡¥æ‡¥ô‡µç‡¥ô‡µÅ‡¥ï", // Vanthotil Krishi Sadhanangal Online-ayi Vanguka
            tip_prefix: "üí° ‡¥∏‡µÇ‡¥ö‡¥®:", // Soochana:
            tip_text: "‡¥Æ‡¥ø‡¥ï‡¥ö‡µç‡¥ö ‡¥ì‡¥´‡¥±‡µÅ‡¥ï‡µæ‡¥ï‡µç‡¥ï‡¥æ‡¥Ø‡¥ø ‡¥µ‡¥ø‡¥µ‡¥ø‡¥ß ‡¥™‡µç‡¥≤‡¥æ‡¥±‡µç‡¥±‡µç‚Äå‡¥´‡µã‡¥Æ‡µÅ‡¥ï‡¥≥‡¥ø‡¥≤‡µÜ ‡¥µ‡¥ø‡¥≤‡¥ï‡µæ ‡¥§‡¥æ‡¥∞‡¥§‡¥Æ‡µç‡¥Ø‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï!", // Mikacha Offerukalkkayi Vibhinna Platformukalile Vilakal Tharamathamyam Cheyyuka!
            nav_home: "‡¥π‡µã‡¥Ç", // Home
            nav_roadmap: "‡¥±‡µã‡¥°‡µç‚Äå‡¥Æ‡¥æ‡¥™‡µç‡¥™‡µç", // Roadmap
            nav_schemes: "‡¥™‡¥¶‡µç‡¥ß‡¥§‡¥ø‡¥ï‡µæ", // Paddhathikal
            nav_shop: "‡¥∑‡µã‡¥™‡µç‡¥™‡µç", // Shop
            message_on_shop: "‡¥®‡¥ø‡¥≤‡¥µ‡¥ø‡µΩ ‡¥∑‡µã‡¥™‡µç‡¥™‡¥ø‡¥Ç‡¥ó‡µç ‡¥™‡µá‡¥ú‡¥ø‡¥≤‡¥æ‡¥£‡µç" // Nilavil Shopping Pageilanu
        }
    };

    /**
     * Translates static UI elements based on the currentLang.
     */
    function translateUI() {
        const t = translations[currentLang];
        document.getElementById('pageTitle').textContent = t.title;
        document.getElementById('backButton').title = t.back_to_dashboard;
        document.getElementById('headerTitle').textContent = t.header_title;
        document.getElementById('headerSubtitle').textContent = t.header_subtitle;
        document.getElementById('tipPrefix').textContent = t.tip_prefix;
        document.getElementById('tipText').textContent = t.tip_text;

        document.getElementById('navHome').textContent = t.nav_home;
        document.getElementById('navRoadmap').textContent = t.nav_roadmap;
        document.getElementById('navSchemes').textContent = t.nav_schemes;
        document.getElementById('navShop').textContent = t.nav_shop;

        // Update language toggle button text
        document.getElementById('langToggle').textContent = currentLang.toUpperCase();

        renderShops(); // Re-render dynamic content with new language
    }

    /**
     * Toggles the current language between English and Malayalam.
     */
    function toggleLanguage() {
        currentLang = currentLang === 'en' ? 'ml' : 'en';
        localStorage.setItem('appLang', currentLang);
        translateUI();
    }
    // --- End Global Language and Translation Setup ---


    // Shopping platforms data - NOW WITH MALAYALAM FIELDS
    let shoppingPlatforms = [
        {
            id: 1,
            name: 'Kisan Mart',
            description: 'Complete range of agricultural inputs and farming equipment',
            description_ml: '‡¥ï‡µÉ‡¥∑‡¥ø‡¥ï‡µç‡¥ï‡µç ‡¥Ü‡¥µ‡¥∂‡µç‡¥Ø‡¥Æ‡¥æ‡¥Ø ‡¥∏‡¥æ‡¥ß‡¥®‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ‡¥Ø‡µÅ‡¥Ç ‡¥â‡¥™‡¥ï‡¥∞‡¥£‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ‡¥Ø‡µÅ‡¥Ç ‡¥∏‡¥Æ‡µç‡¥™‡µÇ‡µº‡¥£‡µç‡¥£ ‡¥∂‡µç‡¥∞‡µá‡¥£‡¥ø',
            category: 'All Products',
            category_ml: '‡¥é‡¥≤‡µç‡¥≤‡¥æ ‡¥â‡µΩ‡¥™‡µç‡¥™‡¥®‡µç‡¥®‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥Ç',
            url: 'https://kisanmart.online.com',
            icon: 'üåæ',
            offers: 'Free delivery on orders above ‚Çπ50,000',
            offers_ml: '‚Çπ50,000-‡¥®‡µç ‡¥Æ‡µÅ‡¥ï‡¥≥‡¥ø‡¥≤‡µÅ‡¥≥‡µç‡¥≥ ‡¥ì‡µº‡¥°‡¥±‡µÅ‡¥ï‡µæ‡¥ï‡µç‡¥ï‡µç ‡¥∏‡µó‡¥ú‡¥®‡µç‡¥Ø ‡¥°‡µÜ‡¥≤‡¥ø‡¥µ‡¥±‡¥ø'
        },
        {
            id: 2,
            name: 'BigHaat',
            description: 'Seeds, fertilizers, pesticides and farm equipment',
            description_ml: '‡¥µ‡¥ø‡¥§‡µç‡¥§‡µÅ‡¥ï‡µæ, ‡¥µ‡¥≥‡¥ô‡µç‡¥ô‡µæ, ‡¥ï‡µÄ‡¥ü‡¥®‡¥æ‡¥∂‡¥ø‡¥®‡¥ø‡¥ï‡µæ, ‡¥ï‡¥æ‡µº‡¥∑‡¥ø‡¥ï ‡¥â‡¥™‡¥ï‡¥∞‡¥£‡¥ô‡µç‡¥ô‡µæ',
            category: 'Seeds & Fertilizers',
            category_ml: '‡¥µ‡¥ø‡¥§‡µç‡¥§‡µÅ‡¥ï‡¥≥‡µÅ‡¥Ç ‡¥µ‡¥≥‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥Ç',
            url: 'https://www.bighaat.com',
            icon: 'üå±',
            offers: 'Up to 20% off on bulk orders',
            offers_ml: '‡¥µ‡µª‡¥§‡µã‡¥§‡¥ø‡¥≤‡µÅ‡¥≥‡µç‡¥≥ ‡¥ì‡µº‡¥°‡¥±‡µÅ‡¥ï‡µæ‡¥ï‡µç‡¥ï‡µç 20% ‡¥µ‡¥∞‡µÜ ‡¥ï‡¥ø‡¥¥‡¥ø‡¥µ‡µç'
        },
        {
            id: 3,
            name: 'AgroStar',
            description: 'Quality agri-inputs with expert advice',
            description_ml: '‡¥µ‡¥ø‡¥¶‡¥ó‡µç‡¥¶‡µç‡¥ß‡µã‡¥™‡¥¶‡µá‡¥∂‡¥§‡µç‡¥§‡µã‡¥ü‡µÅ‡¥ï‡µÇ‡¥ü‡¥ø‡¥Ø ‡¥ó‡µÅ‡¥£‡¥Æ‡µá‡¥®‡µç‡¥Æ‡¥Ø‡µÅ‡¥≥‡µç‡¥≥ ‡¥ï‡¥æ‡µº‡¥∑‡¥ø‡¥ï ‡¥â‡µΩ‡¥™‡µç‡¥™‡¥®‡µç‡¥®‡¥ô‡µç‡¥ô‡µæ',
            category: 'Pesticides & Tools',
            category_ml: '‡¥ï‡µÄ‡¥ü‡¥®‡¥æ‡¥∂‡¥ø‡¥®‡¥ø‡¥ï‡¥≥‡µÅ‡¥Ç ‡¥â‡¥™‡¥ï‡¥∞‡¥£‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥Ç',
            url: 'https://www.agrostar.in',
            icon: 'üõ°Ô∏è',
            offers: 'Expert agronomist consultation included',
            offers_ml: '‡¥µ‡¥ø‡¥¶‡¥ó‡µç‡¥¶‡µç‡¥ß ‡¥ï‡¥æ‡µº‡¥∑‡¥ø‡¥ï‡µã‡¥™‡¥¶‡µá‡¥∑‡µç‡¥ü‡¥æ‡¥µ‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥ï‡µ∫‡¥∏‡µæ‡¥ü‡µç‡¥ü‡µá‡¥∑‡µª ‡¥â‡µæ‡¥™‡µç‡¥™‡µÜ‡¥ü‡µÅ‡¥®‡µç‡¥®‡µÅ'
        },
        {
            id: 4,
            name: 'Dehaat',
            description: 'End-to-end agricultural services and products',
            description_ml: '‡¥∏‡¥Æ‡¥ó‡µç‡¥∞‡¥Æ‡¥æ‡¥Ø ‡¥ï‡¥æ‡µº‡¥∑‡¥ø‡¥ï ‡¥∏‡µá‡¥µ‡¥®‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥Ç ‡¥â‡µΩ‡¥™‡µç‡¥™‡¥®‡µç‡¥®‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥Ç',
            category: 'All Products',
            category_ml: '‡¥é‡¥≤‡µç‡¥≤‡¥æ ‡¥â‡µΩ‡¥™‡µç‡¥™‡¥®‡µç‡¥®‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥Ç',
            url: 'https://www.dehaat.com',
            icon: 'üöú',
            offers: 'Credit facility available',
            offers_ml: '‡¥ï‡µç‡¥∞‡µÜ‡¥°‡¥ø‡¥±‡µç‡¥±‡µç ‡¥∏‡µó‡¥ï‡¥∞‡µç‡¥Ø‡¥Ç ‡¥≤‡¥≠‡µç‡¥Ø‡¥Æ‡¥æ‡¥£‡µç'
        },
        {
            id: 5,
            name: 'Ninjacart',
            description: 'Fresh produce supply chain and agri solutions',
            description_ml: '‡¥™‡µÅ‡¥§‡¥ø‡¥Ø ‡¥â‡µΩ‡¥™‡µç‡¥™‡¥®‡µç‡¥® ‡¥µ‡¥ø‡¥§‡¥∞‡¥£ ‡¥∂‡µÉ‡¥Ç‡¥ñ‡¥≤‡¥Ø‡µÅ‡¥Ç ‡¥ï‡¥æ‡µº‡¥∑‡¥ø‡¥ï ‡¥™‡¥∞‡¥ø‡¥π‡¥æ‡¥∞‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥Ç',
            category: 'Produce & Supplies',
            category_ml: '‡¥â‡µΩ‡¥™‡µç‡¥™‡¥®‡µç‡¥®‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥Ç ‡¥µ‡¥ø‡¥§‡¥∞‡¥£‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥Ç',
            url: 'https://www.ninjacart.com',
            icon: 'ü•¨',
            offers: 'Direct from farm to market',
            offers_ml: '‡¥ï‡µÉ‡¥∑‡¥ø‡¥Ø‡¥ø‡¥ü‡¥§‡µç‡¥§‡¥ø‡µΩ ‡¥®‡¥ø‡¥®‡µç‡¥®‡µç ‡¥®‡µá‡¥∞‡¥ø‡¥ü‡µç‡¥ü‡µç ‡¥µ‡¥ø‡¥™‡¥£‡¥ø‡¥Ø‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç'
        },
        {
            id: 6,
            name: 'Gramophone',
            description: 'Smart farming solutions and agri-inputs',
            description_ml: '‡¥∏‡µç‡¥Æ‡¥æ‡µº‡¥ü‡µç‡¥ü‡µç ‡¥ï‡µÉ‡¥∑‡¥ø ‡¥™‡¥∞‡¥ø‡¥π‡¥æ‡¥∞‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥Ç ‡¥ï‡¥æ‡µº‡¥∑‡¥ø‡¥ï ‡¥â‡µΩ‡¥™‡µç‡¥™‡¥®‡µç‡¥®‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥Ç',
            category: 'Smart Farming',
            category_ml: '‡¥∏‡µç‡¥Æ‡¥æ‡µº‡¥ü‡µç‡¥ü‡µç ‡¥ï‡µÉ‡¥∑‡¥ø',
            url: 'https://www.gramophone.in',
            icon: 'üì±',
            offers: 'AI-powered crop advisory',
            offers_ml: 'AI ‡¥Ö‡¥ß‡¥ø‡¥∑‡µç‡¥†‡¥ø‡¥§ ‡¥µ‡¥ø‡¥≥ ‡¥â‡¥™‡¥¶‡µá‡¥∂‡¥Ç'
        },
        {
            id: 7,
            name: 'Tractor Junction',
            description: 'New & used tractors, implements and equipment',
            description_ml: '‡¥™‡µÅ‡¥§‡¥ø‡¥Ø‡¥§‡µÅ‡¥Ç ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ö‡µç‡¥ö‡¥§‡µÅ‡¥Æ‡¥æ‡¥Ø ‡¥ü‡µç‡¥∞‡¥æ‡¥ï‡µç‡¥ü‡¥±‡µÅ‡¥ï‡¥≥‡µÅ‡¥Ç ‡¥â‡¥™‡¥ï‡¥∞‡¥£‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥Ç',
            category: 'Heavy Equipment',
            category_ml: '‡¥µ‡¥≤‡¥ø‡¥Ø ‡¥â‡¥™‡¥ï‡¥∞‡¥£‡¥ô‡µç‡¥ô‡µæ',
            url: 'https://www.tractorjunction.com',
            icon: 'üöú',
            offers: 'Easy EMI options available',
            offers_ml: '‡¥é‡¥≥‡µÅ‡¥™‡µç‡¥™‡¥Æ‡µÅ‡¥≥‡µç‡¥≥ EMI ‡¥ì‡¥™‡µç‡¥∑‡¥®‡µÅ‡¥ï‡µæ ‡¥≤‡¥≠‡µç‡¥Ø‡¥Æ‡¥æ‡¥£‡µç'
        },
        {
            id: 8,
            name: 'Fasal',
            description: 'IoT-based precision farming and crop management',
            description_ml: 'IoT ‡¥Ö‡¥ü‡¥ø‡¥∏‡µç‡¥•‡¥æ‡¥®‡¥Æ‡¥æ‡¥ï‡µç‡¥ï‡¥ø‡¥Ø‡µÅ‡¥≥‡µç‡¥≥ ‡¥ï‡µÉ‡¥§‡µç‡¥Ø‡¥§‡¥æ ‡¥ï‡µÉ‡¥∑‡¥ø‡¥Ø‡µÅ‡¥Ç ‡¥µ‡¥ø‡¥≥ ‡¥™‡¥∞‡¥ø‡¥™‡¥æ‡¥≤‡¥®‡¥µ‡µÅ‡¥Ç',
            category: 'Technology',
            category_ml: '‡¥∏‡¥æ‡¥ô‡µç‡¥ï‡µá‡¥§‡¥ø‡¥ï‡¥µ‡¥ø‡¥¶‡µç‡¥Ø',
            url: 'https://www.fasal.co',
            icon: 'üíß',
            offers: 'Smart irrigation solutions',
            offers_ml: '‡¥∏‡µç‡¥Æ‡¥æ‡µº‡¥ü‡µç‡¥ü‡µç ‡¥ú‡¥≤‡¥∏‡µá‡¥ö‡¥® ‡¥™‡¥∞‡¥ø‡¥π‡¥æ‡¥∞‡¥ô‡µç‡¥ô‡µæ'
        }
    ];

    function showMessage(message, duration = 3000) {
        const messageBox = document.getElementById('message-box');
        messageBox.textContent = message;
        messageBox.style.display = 'block';
        setTimeout(() => {
            messageBox.style.display = 'none';
        }, duration);
    }

    function createEmoji(container) {
        const emojis = ['ü•ï', 'üçé', 'üçì', 'ü•¨', 'ü•¶', 'üåΩ', 'üçä', 'üçÖ', 'üå±'];
        const emoji = document.createElement('span');
        emoji.className = 'floating-emoji';
        emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];

        const startX = Math.random() * 100;
        const startY = Math.random() * 100;
        const size = 1.5 + Math.random() * 1.5;
        const duration = 10 + Math.random() * 5;

        emoji.style.left = `${startX}%`;
        emoji.style.top = `${startY}%`;
        emoji.style.fontSize = `${size}rem`;
        emoji.style.animationDuration = `${duration}s`;
        emoji.style.animationDelay = `${Math.random() * duration}s`;

        container.appendChild(emoji);
    }

    function populateContainerWithEmojis(container, count) {
        for (let i = 0; i < count; i++) {
            createEmoji(container);
        }
    }

    /**
     * Handles opening external URLs.
     * @param {string} url The external URL to open.
     */
    function openExternalLink(url) {
        if (window.Android && window.Android.openExternalUrl) {
            console.log("Delegating external URL to Kotlin:", url);
            window.Android.openExternalUrl(url);
        } else {
            console.warn("Native bridge 'window.Android.openExternalUrl' not found. Opening URL directly in a new tab.");
            window.open(url, '_blank');
        }
    }


    function renderShops() {
        const container = document.getElementById('shopsContainer');
        container.innerHTML = '';

        // Determine which fields to use based on the current language
        const categoryKey = currentLang === 'ml' ? 'category_ml' : 'category';
        const descriptionKey = currentLang === 'ml' ? 'description_ml' : 'description';
        const offersKey = currentLang === 'ml' ? 'offers_ml' : 'offers';

        shoppingPlatforms.forEach(shop => {
            const shopCard = document.createElement('div');
            shopCard.className = 'shop-card bg-white p-5 rounded-3xl shadow-lg relative overflow-hidden block';
            shopCard.onclick = () => openExternalLink(shop.url);

            const emojiContainer = document.createElement('div');
            emojiContainer.className = 'floating-emoji-container';
            shopCard.appendChild(emojiContainer);
            populateContainerWithEmojis(emojiContainer, 5);

            // Check if using image or icon
            const imageContent = shop.imageUrl
                ? `<img src="${shop.imageUrl}" alt="${shop.name}" class="shop-image" />`
                : `<div class="shop-image">${shop.icon}</div>`;

            shopCard.innerHTML += `
                <div class="relative z-10">
                    <div class="mb-4">
                        ${imageContent}
                    </div>

                    <div class="space-y-2">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h3 class="text-lg font-bold text-gray-800">${shop.name}</h3>
                                <span class="category-badge mt-1 inline-block">${shop[categoryKey]}</span>
                            </div>
                            <span class="external-link-icon text-2xl">‚Üí</span>
                        </div>

                        <p class="text-sm text-gray-600">${shop[descriptionKey]}</p>

                        <div class="bg-green-50 p-3 rounded-xl mt-3">
                            <p class="text-xs text-green-800">üéÅ <span class="font-semibold">${shop[offersKey]}</span></p>
                        </div>
                    </div>
                </div>
            `;

            container.appendChild(shopCard);
        });
    }

    // Navigation functions for the bottom bar
    function navigateToDashboard() {
        if (window.Android && window.Android.navigateToDashboard) {
            window.Android.navigateToDashboard();
        } else {
            window.location.href = 'dashboard.html';
        }
    }

    function navigateToRoadmap() {
        if (window.Android && window.Android.navigateToRoadmap) {
            window.Android.navigateToRoadmap();
        } else {
            window.location.href = 'small_scale_roadmap.html';
        }
    }

    function navigateToSchemes() {
        if (window.Android && window.Android.navigateToSchemes) {
            window.Android.navigateToSchemes();
        } else {
            window.location.href = 'gov_schemes.html';
        }
    }

    function navigateToShopping() {
        const message = translations[currentLang].message_on_shop;
        if (window.Android && window.Android.navigateToShopping) {
            window.Android.navigateToShopping();
        } else {
            showMessage(message);
        }
    }

    // Public API for updating shopping platforms from Kotlin (updated to handle new fields)
    window.updateShoppingPlatforms = function(newPlatforms) {
        try {
            if (typeof newPlatforms === 'string') {
                shoppingPlatforms = JSON.parse(newPlatforms);
            } else {
                shoppingPlatforms = newPlatforms;
            }
            renderShops();
            return true;
        } catch (e) {
            console.error('Error updating shopping platforms:', e);
            return false;
        }
    };

    // Initialize page
    document.addEventListener('DOMContentLoaded', () => {
        populateContainerWithEmojis(document.getElementById('headerEmojis'), 8);
        // Load the initial language state
        translateUI();
    });
</script>
</body>
</html>
