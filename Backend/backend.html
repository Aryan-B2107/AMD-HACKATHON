<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIH Problem Statements Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .file-upload {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: #2980b9;
            background: #e8f4f8;
        }

        .upload-area input[type="file"] {
            display: none;
        }

        .upload-btn {
            background: #3498db;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            margin: 0 10px 10px 0;
            transition: all 0.3s ease;
        }

        .upload-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .charts-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 1.3em;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        .data-table {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            font-size: 1em;
            min-width: 150px;
        }

        .filter-select:focus {
            outline: none;
            border-color: #3498db;
        }

        .search-box {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            flex: 1;
            min-width: 200px;
        }

        .search-box:focus {
            outline: none;
            border-color: #3498db;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .domain-tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
            color: white;
            text-transform: capitalize;
        }

        .domain-agriculture { background: #27ae60; }
        .domain-healthcare { background: #e74c3c; }
        .domain-education { background: #f39c12; }
        .domain-transportation { background: #3498db; }
        .domain-tourism { background: #9b59b6; }
        .domain-disaster_management { background: #e67e22; }
        .domain-environment { background: #2ecc71; }
        .domain-governance { background: #34495e; }
        .domain-security { background: #c0392b; }
        .domain-fintech { background: #16a085; }
        .domain-smart_city { background: #8e44ad; }
        .domain-others { background: #95a5a6; }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 1.2em;
        }

        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .success {
            background: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .charts-section {
                grid-template-columns: 1fr;
            }

            .filters {
                flex-direction: column;
            }

            .stat-number {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÜ SIH Problem Statements Dashboard</h1>
            <p>Smart India Hackathon 2024/25 - Data Visualization & Analysis</p>
        </div>

        <div class="file-upload">
            <div class="upload-area" onclick="document.getElementById('jsonFile').click()">
                <h3>üìÅ Load Data Files</h3>
                <p>Click to select JSON or CSV files generated by the SIH scraper</p>
                <input type="file" id="jsonFile" accept=".json,.csv" onchange="loadFile(this)">
                <button class="upload-btn" onclick="document.getElementById('jsonFile').click()">Choose JSON File</button>
                <button class="upload-btn" onclick="document.getElementById('csvFile').click()">Choose CSV File</button>
                <input type="file" id="csvFile" accept=".csv" onchange="loadCSVFile(this)">
            </div>
        </div>

        <div id="stats" class="stats-grid" style="display: none;">
            <div class="stat-card">
                <div class="stat-number" id="totalProblems">0</div>
                <div class="stat-label">Total Problems</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalOrganizations">0</div>
                <div class="stat-label">Organizations</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalDomains">0</div>
                <div class="stat-label">Domain Categories</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalIdeas">0</div>
                <div class="stat-label">Submitted Ideas</div>
            </div>
        </div>

        <div id="charts" class="charts-section" style="display: none;">
            <div class="chart-container">
                <div class="chart-title">Problems by Domain</div>
                <canvas id="domainChart"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">Top Organizations</div>
                <canvas id="organizationChart"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">Category Distribution</div>
                <canvas id="categoryChart"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">Theme Distribution</div>
                <canvas id="themeChart"></canvas>
            </div>
        </div>

        <div id="dataTable" class="data-table" style="display: none;">
            <h2>üìä Problem Statements Data</h2>
            <div class="filters">
                <select id="domainFilter" class="filter-select" onchange="filterData()">
                    <option value="">All Domains</option>
                </select>
                <select id="organizationFilter" class="filter-select" onchange="filterData()">
                    <option value="">All Organizations</option>
                </select>
                <select id="categoryFilter" class="filter-select" onchange="filterData()">
                    <option value="">All Categories</option>
                </select>
                <input type="text" id="searchBox" class="search-box" placeholder="Search problem titles..." onkeyup="filterData()">
            </div>
            <div id="tableContainer"></div>
        </div>
    </div>

    <script>
        let globalData = [];
        let filteredData = [];
        let charts = {};

        function loadFile(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    processData(data);
                    showSuccess('JSON file loaded successfully!');
                } catch (error) {
                    showError('Error parsing JSON file: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function loadCSVFile(input) {
            const file = input.files[0];
            if (!file) return;

            Papa.parse(file, {
                header: true,
                complete: function(results) {
                    processData(results.data);
                    showSuccess('CSV file loaded successfully!');
                },
                error: function(error) {
                    showError('Error parsing CSV file: ' + error.message);
                }
            });
        }

        function processData(data) {
            globalData = Array.isArray(data) ? data : [data];
            filteredData = [...globalData];

            updateStats();
            createCharts();
            createTable();
            populateFilters();

            document.getElementById('stats').style.display = 'grid';
            document.getElementById('charts').style.display = 'grid';
            document.getElementById('dataTable').style.display = 'block';
        }

        function updateStats() {
            const totalProblems = globalData.length;
            const organizations = new Set(globalData.map(p => p.organization)).size;
            const domains = new Set(globalData.map(p => p.domain_category)).size;
            const totalIdeas = globalData.reduce((sum, p) => sum + (parseInt(p.submitted_ideas) || 0), 0);

            document.getElementById('totalProblems').textContent = totalProblems;
            document.getElementById('totalOrganizations').textContent = organizations;
            document.getElementById('totalDomains').textContent = domains;
            document.getElementById('totalIdeas').textContent = totalIdeas;
        }

        function createCharts() {
            createDomainChart();
            createOrganizationChart();
            createCategoryChart();
            createThemeChart();
        }

        function createDomainChart() {
            const ctx = document.getElementById('domainChart').getContext('2d');
            const domainCounts = {};

            globalData.forEach(problem => {
                const domain = problem.domain_category || 'others';
                domainCounts[domain] = (domainCounts[domain] || 0) + 1;
            });

            const sortedDomains = Object.entries(domainCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 10);

            if (charts.domain) charts.domain.destroy();

            charts.domain = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: sortedDomains.map(([domain]) => domain.replace('_', ' ').toUpperCase()),
                    datasets: [{
                        data: sortedDomains.map(([, count]) => count),
                        backgroundColor: [
                            '#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6',
                            '#1abc9c', '#34495e', '#e67e22', '#95a5a6', '#d35400'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createOrganizationChart() {
            const ctx = document.getElementById('organizationChart').getContext('2d');
            const orgCounts = {};

            globalData.forEach(problem => {
                const org = problem.organization || 'Unknown';
                orgCounts[org] = (orgCounts[org] || 0) + 1;
            });

            const sortedOrgs = Object.entries(orgCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 8);

            if (charts.organization) charts.organization.destroy();

            charts.organization = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedOrgs.map(([org]) => org.length > 30 ? org.substring(0, 30) + '...' : org),
                    datasets: [{
                        label: 'Problems Count',
                        data: sortedOrgs.map(([, count]) => count),
                        backgroundColor: '#3498db'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createCategoryChart() {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            const categoryCounts = {};

            globalData.forEach(problem => {
                const category = problem.category || 'Unknown';
                categoryCounts[category] = (categoryCounts[category] || 0) + 1;
            });

            if (charts.category) charts.category.destroy();

            charts.category = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(categoryCounts),
                    datasets: [{
                        data: Object.values(categoryCounts),
                        backgroundColor: ['#e74c3c', '#2ecc71', '#f39c12']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createThemeChart() {
            const ctx = document.getElementById('themeChart').getContext('2d');
            const themeCounts = {};

            globalData.forEach(problem => {
                const theme = problem.theme || 'Unknown';
                themeCounts[theme] = (themeCounts[theme] || 0) + 1;
            });

            const sortedThemes = Object.entries(themeCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 8);

            if (charts.theme) charts.theme.destroy();

            charts.theme = new Chart(ctx, {
                type: 'horizontalBar',
                data: {
                    labels: sortedThemes.map(([theme]) => theme.length > 25 ? theme.substring(0, 25) + '...' : theme),
                    datasets: [{
                        label: 'Problems Count',
                        data: sortedThemes.map(([, count]) => count),
                        backgroundColor: '#9b59b6'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function populateFilters() {
            const domains = [...new Set(globalData.map(p => p.domain_category))].sort();
            const organizations = [...new Set(globalData.map(p => p.organization))].sort();
            const categories = [...new Set(globalData.map(p => p.category))].sort();

            populateSelect('domainFilter', domains);
            populateSelect('organizationFilter', organizations);
            populateSelect('categoryFilter', categories);
        }

        function populateSelect(selectId, options) {
            const select = document.getElementById(selectId);
            // Keep the first option (All...)
            select.innerHTML = select.children[0].outerHTML;

            options.forEach(option => {
                if (option) {
                    const optionElement = document.createElement('option');
                    optionElement.value = option;
                    optionElement.textContent = option;
                    select.appendChild(optionElement);
                }
            });
        }

        function filterData() {
            const domainFilter = document.getElementById('domainFilter').value;
            const organizationFilter = document.getElementById('organizationFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            const searchText = document.getElementById('searchBox').value.toLowerCase();

            filteredData = globalData.filter(problem => {
                const matchesDomain = !domainFilter || problem.domain_category === domainFilter;
                const matchesOrganization = !organizationFilter || problem.organization === organizationFilter;
                const matchesCategory = !categoryFilter || problem.category === categoryFilter;
                const matchesSearch = !searchText ||
                    (problem.problem_title && problem.problem_title.toLowerCase().includes(searchText));

                return matchesDomain && matchesOrganization && matchesCategory && matchesSearch;
            });

            createTable();
        }

        function createTable() {
            const container = document.getElementById('tableContainer');

            if (filteredData.length === 0) {
                container.innerHTML = '<div class="loading">No data matches the current filters.</div>';
                return;
            }

            const table = document.createElement('table');

            // Create header
            const header = table.createTHead();
            const headerRow = header.insertRow();
            const columns = ['S.No', 'Organization', 'Problem Title', 'Domain', 'Category', 'PS Number', 'Ideas', 'Theme'];

            columns.forEach(col => {
                const th = document.createElement('th');
                th.textContent = col;
                headerRow.appendChild(th);
            });

            // Create body
            const tbody = table.createTBody();

            filteredData.slice(0, 100).forEach(problem => { // Limit to 100 for performance
                const row = tbody.insertRow();

                row.insertCell().textContent = problem.s_no || '-';

                const orgCell = row.insertCell();
                orgCell.textContent = problem.organization || '-';
                orgCell.title = problem.organization || '';

                const titleCell = row.insertCell();
                titleCell.textContent = problem.problem_title || '-';
                titleCell.title = problem.problem_title || '';
                titleCell.style.maxWidth = '300px';
                titleCell.style.overflow = 'hidden';
                titleCell.style.textOverflow = 'ellipsis';
                titleCell.style.whiteSpace = 'nowrap';

                const domainCell = row.insertCell();
                if (problem.domain_category) {
                    const domainTag = document.createElement('span');
                    domainTag.className = `domain-tag domain-${problem.domain_category}`;
                    domainTag.textContent = problem.domain_category.replace('_', ' ');
                    domainCell.appendChild(domainTag);
                } else {
                    domainCell.textContent = '-';
                }

                row.insertCell().textContent = problem.category || '-';
                row.insertCell().textContent = problem.ps_number || '-';
                row.insertCell().textContent = problem.submitted_ideas || '0';

                const themeCell = row.insertCell();
                themeCell.textContent = problem.theme || '-';
                themeCell.title = problem.theme || '';
                themeCell.style.maxWidth = '200px';
                themeCell.style.overflow = 'hidden';
                themeCell.style.textOverflow = 'ellipsis';
                themeCell.style.whiteSpace = 'nowrap';
            });

            container.innerHTML = '';
            container.appendChild(table);

            if (filteredData.length > 100) {
                const notice = document.createElement('p');
                notice.textContent = `Showing first 100 of ${filteredData.length} results. Use filters to narrow down.`;
                notice.style.marginTop = '10px';
                notice.style.color = '#7f8c8d';
                notice.style.fontStyle = 'italic';
                container.appendChild(notice);
            }
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            document.querySelector('.container').insertBefore(errorDiv, document.querySelector('.file-upload').nextSibling);
            setTimeout(() => errorDiv.remove(), 5000);
        }

        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            document.querySelector('.container').insertBefore(successDiv, document.querySelector('.file-upload').nextSibling);
            setTimeout(() => successDiv.remove(), 3000);
        }

        // Sample data for demonstration
        function loadSampleData() {
            const sampleData = [
                {
                    s_no: "1",
                    organization: "Ministry of Development of North Eastern Region",
                    problem_title: "Smart Community Health Monitoring and Early Warning System for Water-Borne Diseases in Rural Northeast India",
                    category: "Software",
                    ps_number: "SIH25001",
                    submitted_ideas: "15",
                    theme: "MedTech / BioTech / HealthTech",
                    domain_category: "healthcare"
                },
                {
                    s_no: "2",
                    organization: "Ministry of Development of North Eastern Region",
                    problem_title: "Smart Tourist Safety Monitoring & Incident Response System using AI, Geo-Fencing, and Blockchain-based Digital ID",
                    category: "Software",
                    ps_number: "SIH25002",
                    submitted_ideas: "8",
                    theme: "Travel & Tourism",
                    domain_category: "tourism"
                },
                {
                    s_no: "3",
                    organization: "Ministry of Fisheries, Animal Husbandry & Dairying",
                    problem_title: "Image based breed recognition for cattle and buffaloes of India",
                    category: "Software",
                    ps_number: "SIH25004",
                    submitted_ideas: "12",
                    theme: "Agriculture, FoodTech & Rural Development",
                    domain_category: "agriculture"
                }
            ];

            processData(sampleData);
        }

        // Load sample data on page load for demonstration
        document.addEventListener('DOMContentLoaded', function() {
            // Uncomment the line below to load sample data automatically
            // loadSampleData();
        });
    </script>
</body>
</html>